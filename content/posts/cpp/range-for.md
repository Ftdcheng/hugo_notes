---
title: "C++ range for"
date: 2025-04-22
author: "Citrus Cheng"
tags: ["cpp"]
---

# C++ range for

è¦è®©ä¸€ä¸ªå¯¹è±¡èƒ½è¢«ç”¨äº C++ çš„ **range-based for loop**ï¼ˆèŒƒå›´ for å¾ªç¯ï¼‰ä¸­ï¼Œå®ƒçš„ç±»éœ€è¦éµå¾ªä¸€å®šçš„â€œåè®®â€ï¼Œå³æ»¡è¶³ä¸€ç»„ç‰¹å®šçš„è¦æ±‚ã€‚è¿™ä¸ªåè®®**ä¸æ˜¯å½¢å¼åŒ–çš„æ¥å£**ï¼ˆä¸åƒ Java é‚£æ ·æœ‰ `Iterable` æ¥å£ï¼‰ï¼Œä½†ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œä¸€ä¸ªâ€œæ¦‚å¿µâ€ï¼ˆconceptï¼‰æˆ–â€œçº¦å®šâ€ã€‚

æˆ‘ä»¬æ¥æ‹†ä¸€ä¸‹ç»†èŠ‚ï¼š

---

### âœ… **C++ range for çš„åº•å±‚è¯­ä¹‰**
```cpp
for (auto x : container) {
    // ...
}
```
ç­‰ä»·äºï¼š
```cpp
{
    auto&& __range = container;
    auto __begin = begin(__range);
    auto __end = end(__range);
    for (; __begin != __end; ++__begin) {
        auto x = *__begin;
        // ...
    }
}
```

ä¹Ÿå°±æ˜¯è¯´ï¼š

---

### ğŸ”‘ ä½ çš„ç±»éœ€è¦æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

#### 1. `begin(obj)` å’Œ `end(obj)` å¿…é¡»èƒ½è¢«è°ƒç”¨
- è¿™é€šå¸¸æ„å‘³ç€ï¼š
  - ä½ çš„ç±»æœ‰æˆå‘˜å‡½æ•° `begin()` å’Œ `end()`ï¼Œ**æˆ–è€…**
  - å¯¹ä½ çš„ç±»å®šä¹‰äº†é€‚é…çš„ `begin()` å’Œ `end()` éæˆå‘˜å‡½æ•°ã€‚

C++æ ‡å‡†åº“çš„ `std::begin()` å’Œ `std::end()` å…¶å®å¯ä»¥å¤„ç†å¾ˆå¤šæƒ…å†µï¼ŒåŒ…æ‹¬æ•°ç»„ã€æ ‡å‡†å®¹å™¨ã€è‡ªå®šä¹‰ç±»ï¼ˆåªè¦æœ‰ `.begin()`ã€`.end()`ï¼‰ã€‚

#### 2. `begin()` å’Œ `end()` è¿”å›ä¸€ä¸ªâ€œè¿­ä»£å™¨â€
è¿™ä¸ªâ€œè¿­ä»£å™¨â€è¦æ”¯æŒï¼š
- `*it`ï¼ˆè§£å¼•ç”¨ï¼‰
- `++it`ï¼ˆå‰ç¼€æˆ–åç¼€éƒ½è¡Œï¼‰
- `it != end`ï¼ˆå¯ä»¥æ¯”è¾ƒï¼‰

ä½ å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªç±»ä½œä¸ºè¿­ä»£å™¨ï¼Œåªè¦å®ƒæ»¡è¶³è¿™äº›æ“ä½œï¼Œå°±èƒ½å·¥ä½œã€‚

---

### ğŸ› ï¸ ä¸¾ä¸ªæ —å­ï¼šæ‰‹å†™ä¸€ä¸ªå¯è¿­ä»£ç±»

```cpp
class MyContainer {
public:
    struct Iterator {
        int current;

        int operator*() const { return current; }
        Iterator& operator++() { ++current; return *this; }
        bool operator!=(const Iterator& other) const { return current != other.current; }
    };

    Iterator begin() const { return Iterator{0}; }
    Iterator end() const { return Iterator{5}; }
};
```

ç„¶åå°±èƒ½ï¼š
```cpp
for (int x : MyContainer()) {
    std::cout << x << " ";
}
// è¾“å‡ºï¼š0 1 2 3 4
```

---

### âœ¨ C++20ï¼šå¯ä»¥æ›´â€œæ­£è§„â€ä¸€ç‚¹ï¼ˆä½†å¯é€‰ï¼‰

å¦‚æœä½ ç”¨çš„æ˜¯ C++20ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ `std::ranges::range` æ¦‚å¿µï¼Œå†™æˆï¼š

```cpp
template <std::ranges::range R>
void do_something(R&& r) {
    for (auto&& x : r) {
        // ...
    }
}
```

---

### ğŸ“Œ æ€»ç»“ï¼šç±»è¦æ”¯æŒ range-forï¼Œæ»¡è¶³ä»¥ä¸‹å‡ ç‚¹å°±è¡Œ

| è¦æ±‚ | è¯´æ˜ |
|------|------|
| `begin()` å’Œ `end()` | æˆå‘˜å‡½æ•°æˆ–å¯è¢« `std::begin()/std::end()` æ‰¾åˆ°çš„éæˆå‘˜å‡½æ•° |
| è¿”å›è¿­ä»£å™¨ | begin/end è¿”å›çš„å¯¹è±¡æ”¯æŒï¼š`*`, `++`, `!=` |
| è¿­ä»£å™¨æœ¬èº« | å¯ä»¥æ˜¯ä½ è‡ªå·±å®šä¹‰çš„ç±»æˆ–æŒ‡é’ˆã€æ ‡å‡†è¿­ä»£å™¨ |
