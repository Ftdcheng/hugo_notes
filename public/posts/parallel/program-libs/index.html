<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>å¹¶è¡Œç¼–ç¨‹åº“é‚£äº›äº‹ | Citrus Cheng&#39;s wiki</title>
<meta name="keywords" content="Parallel">
<meta name="description" content="å¹¶è¡Œç¼–ç¨‹åº“é‚£äº›äº‹
OpenMP
âœ… ç®€æ˜å®šä¹‰ï¼ˆå…ˆæ¥ä¸ªâ€œæ­£ç»â€ç‰ˆï¼‰ï¼š

OpenMPï¼ˆOpen Multi-Processingï¼‰æ˜¯ä¸€ä¸ªæ”¯æŒå¤šå¹³å°å…±äº«å†…å­˜å¹¶è¡Œç¼–ç¨‹çš„APIè§„èŒƒï¼Œä¸»è¦ç”¨äºCã€C&#43;&#43; å’Œ Fortranï¼Œé€šè¿‡ç¼–è¯‘å™¨æŒ‡ä»¤ï¼ˆpragmaï¼‰ã€è¿è¡Œæ—¶åº“å‡½æ•°å’Œç¯å¢ƒå˜é‡æ¥å®ç°å¹¶è¡ŒåŒ–ç¨‹åºè®¾è®¡ã€‚

ğŸ§  è°æçš„ï¼Ÿ
OpenMP ä¸æ˜¯æŸä¸€ä¸ªå…¬å¸å•ç‹¬æå‡ºçš„ï¼Œè™½ç„¶ Intel æ˜¯æ—©æœŸé‡è¦æˆå‘˜ä¹‹ä¸€ï¼Œä½†å®é™…ä¸Šå®ƒæ˜¯ç”±ä¸€ä¸ªå«åš OpenMP Architecture Review Board (ARB) çš„ç»„ç»‡å®šä¹‰å’Œç»´æŠ¤çš„ã€‚
è¿™ä¸ª ARB è”ç›Ÿå¤§ä½¬äº‘é›†ï¼Œæ¯”å¦‚ï¼š

Intel
AMD
IBM
HP
Microsoft
NVIDIAï¼ˆæœ€è¿‘ä¹Ÿè¿›æ¥äº†ï¼‰
ç­‰ç­‰ç­‰â€¦

æ‰€ä»¥ä½ å¯ä»¥æŠŠ OpenMP çœ‹ä½œæ˜¯ç¼–è¯‘å™¨å‚å•†è”ç›Ÿçš„ã€Œå’Œå¹³å…±å¤„ã€åè®®ï¼Œè®©å¤§å®¶éƒ½èƒ½å†™å‡º portableï¼ˆå¯ç§»æ¤ï¼‰åˆ efficientï¼ˆé«˜æ•ˆï¼‰çš„å¤šçº¿ç¨‹ä»£ç ã€‚

ğŸ”§ å®ƒå¹²å•¥çš„ï¼Ÿ
OpenMP æœ€å¸¸è§çš„ç”¨é€”æ˜¯â€”â€”ä½ è¯´å¯¹äº†ï¼š

âœ¨ â€œå¹¶è¡Œ for å¾ªç¯â€ï¼
#pragma omp parallel for
for (int i = 0; i &lt; N; &#43;&#43;i) {
    work(i);
}
ä½†ä¸æ­¢è¿™äº›ï¼Œè¿˜æœ‰ï¼š

å¹¶è¡Œ sections
ä»»åŠ¡ (task)
åŸå­æ“ä½œã€äº’æ–¥é” (omp critical, omp atomic)
åŠ¨æ€çº¿ç¨‹æ•°æ§åˆ¶
å¹¶è¡Œ region åµŒå¥—
GPU åŠ é€Ÿï¼ˆOpenMP 5.0&#43; æ”¯æŒ target offloadingï¼ï¼‰


ğŸŒ€ ç®€å• vs çµæ´»
OpenMP çš„è®¾è®¡å“²å­¦å°±æ˜¯ï¼š">
<meta name="author" content="Citrus Cheng">
<link rel="canonical" href="http://localhost:1313/posts/parallel/program-libs/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css" integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF&#43;13Dyqob6ASlTrTye8=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/parallel/program-libs/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Citrus Cheng&#39;s wiki (Alt + H)">Citrus Cheng&#39;s wiki</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      å¹¶è¡Œç¼–ç¨‹åº“é‚£äº›äº‹
    </h1>
    <div class="post-meta"><span title='2025-04-22 00:00:00 +0000 UTC'>April 22, 2025</span>&nbsp;Â·&nbsp;Citrus Cheng

</div>
  </header> 
  <div class="post-content"><h1 id="å¹¶è¡Œç¼–ç¨‹åº“é‚£äº›äº‹">å¹¶è¡Œç¼–ç¨‹åº“é‚£äº›äº‹<a hidden class="anchor" aria-hidden="true" href="#å¹¶è¡Œç¼–ç¨‹åº“é‚£äº›äº‹">#</a></h1>
<h2 id="openmp">OpenMP<a hidden class="anchor" aria-hidden="true" href="#openmp">#</a></h2>
<h3 id="-ç®€æ˜å®šä¹‰å…ˆæ¥ä¸ªæ­£ç»ç‰ˆ">âœ… ç®€æ˜å®šä¹‰ï¼ˆå…ˆæ¥ä¸ªâ€œæ­£ç»â€ç‰ˆï¼‰ï¼š<a hidden class="anchor" aria-hidden="true" href="#-ç®€æ˜å®šä¹‰å…ˆæ¥ä¸ªæ­£ç»ç‰ˆ">#</a></h3>
<blockquote>
<p><strong>OpenMP</strong>ï¼ˆOpen Multi-Processingï¼‰æ˜¯ä¸€ä¸ª<strong>æ”¯æŒå¤šå¹³å°å…±äº«å†…å­˜å¹¶è¡Œç¼–ç¨‹</strong>çš„<strong>APIè§„èŒƒ</strong>ï¼Œä¸»è¦ç”¨äº<strong>Cã€C++ å’Œ Fortran</strong>ï¼Œé€šè¿‡<strong>ç¼–è¯‘å™¨æŒ‡ä»¤ï¼ˆpragmaï¼‰ã€è¿è¡Œæ—¶åº“å‡½æ•°å’Œç¯å¢ƒå˜é‡</strong>æ¥å®ç°<strong>å¹¶è¡ŒåŒ–ç¨‹åºè®¾è®¡</strong>ã€‚</p></blockquote>
<hr>
<h3 id="-è°æçš„">ğŸ§  è°æçš„ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-è°æçš„">#</a></h3>
<p>OpenMP <strong>ä¸æ˜¯æŸä¸€ä¸ªå…¬å¸å•ç‹¬æå‡ºçš„</strong>ï¼Œè™½ç„¶ <strong>Intel æ˜¯æ—©æœŸé‡è¦æˆå‘˜ä¹‹ä¸€</strong>ï¼Œä½†å®é™…ä¸Šå®ƒæ˜¯ç”±ä¸€ä¸ªå«åš <strong>OpenMP Architecture Review Board (ARB)</strong> çš„ç»„ç»‡å®šä¹‰å’Œç»´æŠ¤çš„ã€‚</p>
<p>è¿™ä¸ª ARB è”ç›Ÿå¤§ä½¬äº‘é›†ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>Intel</li>
<li>AMD</li>
<li>IBM</li>
<li>HP</li>
<li>Microsoft</li>
<li>NVIDIAï¼ˆæœ€è¿‘ä¹Ÿè¿›æ¥äº†ï¼‰</li>
<li>ç­‰ç­‰ç­‰â€¦</li>
</ul>
<p>æ‰€ä»¥ä½ å¯ä»¥æŠŠ OpenMP çœ‹ä½œæ˜¯<strong>ç¼–è¯‘å™¨å‚å•†è”ç›Ÿçš„ã€Œå’Œå¹³å…±å¤„ã€åè®®</strong>ï¼Œè®©å¤§å®¶éƒ½èƒ½å†™å‡º portableï¼ˆå¯ç§»æ¤ï¼‰åˆ efficientï¼ˆé«˜æ•ˆï¼‰çš„å¤šçº¿ç¨‹ä»£ç ã€‚</p>
<hr>
<h3 id="-å®ƒå¹²å•¥çš„">ğŸ”§ å®ƒå¹²å•¥çš„ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-å®ƒå¹²å•¥çš„">#</a></h3>
<p>OpenMP æœ€å¸¸è§çš„ç”¨é€”æ˜¯â€”â€”ä½ è¯´å¯¹äº†ï¼š</p>
<blockquote>
<p>âœ¨ â€œå¹¶è¡Œ for å¾ªç¯â€ï¼</p></blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#pragma omp parallel for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> N; <span style="color:#f92672">++</span>i) {
</span></span><span style="display:flex;"><span>    work(i);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä½†ä¸æ­¢è¿™äº›ï¼Œè¿˜æœ‰ï¼š</p>
<ul>
<li>å¹¶è¡Œ <code>sections</code></li>
<li>ä»»åŠ¡ (<code>task</code>)</li>
<li>åŸå­æ“ä½œã€äº’æ–¥é” (<code>omp critical</code>, <code>omp atomic</code>)</li>
<li>åŠ¨æ€çº¿ç¨‹æ•°æ§åˆ¶</li>
<li>å¹¶è¡Œ region åµŒå¥—</li>
<li>GPU åŠ é€Ÿï¼ˆOpenMP 5.0+ æ”¯æŒ target offloadingï¼ï¼‰</li>
</ul>
<hr>
<h3 id="-ç®€å•-vs-çµæ´»">ğŸŒ€ ç®€å• vs çµæ´»<a hidden class="anchor" aria-hidden="true" href="#-ç®€å•-vs-çµæ´»">#</a></h3>
<p>OpenMP çš„è®¾è®¡å“²å­¦å°±æ˜¯ï¼š</p>
<blockquote>
<p>â€œåˆ«é€¼æˆ‘ç”¨ pthreadï¼Œå¿«ç»™æˆ‘ç‚¹ pragmaã€‚â€</p></blockquote>
<p>å®ƒä¸åƒ CUDA éœ€è¦è‡ªå·±å†™å†…æ ¸ï¼Œä¸åƒ TBB ä¸€å¼€å§‹å°±èŠ±é‡Œèƒ¡å“¨æ•°æ®æµå›¾ã€‚å®ƒä¸»æ‰“ä¸€ä¸ªã€Œ<strong>å¢é‡å¼å¹¶è¡Œ</strong>ã€ï¼š</p>
<ul>
<li>ä½ å†™å¥½çš„ä¸²è¡Œä»£ç ï¼Œ</li>
<li>åŠ ä¸ª <code>#pragma omp parallel for</code>ï¼Œ</li>
<li>ç¼–è¯‘å¼€äº† <code>-fopenmp</code>ï¼Œ</li>
<li>å¹¶è¡Œé­”æ³•å‡ºç°äº†ã€‚</li>
</ul>
<hr>
<h3 id="-æ€»ç»“ä¸€ä¸‹ä½ é‚£å¥è¯æ”¹æˆæ›´ç²¾ç¡®çš„ç‰ˆæœ¬">ğŸ—¨ï¸ æ€»ç»“ä¸€ä¸‹ä½ é‚£å¥è¯æ”¹æˆæ›´ç²¾ç¡®çš„ç‰ˆæœ¬ï¼š<a hidden class="anchor" aria-hidden="true" href="#-æ€»ç»“ä¸€ä¸‹ä½ é‚£å¥è¯æ”¹æˆæ›´ç²¾ç¡®çš„ç‰ˆæœ¬">#</a></h3>
<blockquote>
<p>OpenMP æ˜¯ç”±å¤šä¸ªå‚å•†ç»„æˆçš„å¼€æ”¾ç»„ç»‡æå‡ºçš„ï¼Œå¹¶è¡Œç¼–ç¨‹ API è§„èŒƒï¼Œä¸»è¦ç”¨äºåœ¨å…±äº«å†…å­˜å¹³å°ä¸Šç®€æ´åœ°å®ç°å¦‚å¹¶è¡Œå¾ªç¯ç­‰å¹¶è¡Œè®¡ç®—æ“ä½œã€‚</p></blockquote>
<h3 id="ä¸‰é“å¹¶è¡Œå°èœç”¨-openmp-å¿«é€ŸåŠ é€Ÿå›¾åƒå¤„ç†ç‚¹äº‘è®¡ç®—å’ŒçŸ©é˜µä¹˜æ³•">ä¸‰é“å¹¶è¡Œå°èœï¼šç”¨ OpenMP å¿«é€ŸåŠ é€Ÿå›¾åƒå¤„ç†ã€ç‚¹äº‘è®¡ç®—å’ŒçŸ©é˜µä¹˜æ³•<a hidden class="anchor" aria-hidden="true" href="#ä¸‰é“å¹¶è¡Œå°èœç”¨-openmp-å¿«é€ŸåŠ é€Ÿå›¾åƒå¤„ç†ç‚¹äº‘è®¡ç®—å’ŒçŸ©é˜µä¹˜æ³•">#</a></h3>
<blockquote>
<p>â€œå¹¶è¡Œä¸åªæ˜¯åŠ é€Ÿï¼Œæ›´æ˜¯è®©ä»£ç å­¦ä¼šåˆ†èº«æœ¯ã€‚â€<br>
â€”â€”ã€ŠPerf Bookã€‹æ²¡è¿™ä¹ˆè¯´ï¼Œä½†æˆ‘è¯´äº†ã€‚</p></blockquote>
<hr>
<h4 id="-å‰èœå›¾åƒ-2d-å·ç§¯çš„å¹¶è¡ŒåŠ é€Ÿ">ğŸ± å‰èœï¼šå›¾åƒ 2D å·ç§¯çš„å¹¶è¡ŒåŠ é€Ÿ<a hidden class="anchor" aria-hidden="true" href="#-å‰èœå›¾åƒ-2d-å·ç§¯çš„å¹¶è¡ŒåŠ é€Ÿ">#</a></h4>
<p>åœ¨å›¾åƒå¤„ç†ä¸­ï¼ŒäºŒç»´å·ç§¯æ˜¯ä¸ªè€æœ‹å‹ã€‚ä½†å¯¹å¤§å›¾åƒ+å¤§æ ¸æ—¶ï¼Œæ€§èƒ½å°±æˆäº†çƒ¦æ¼ã€‚æ¥ï¼ŒOpenMP å¸®æˆ‘ä»¬å¹¶è¡Œè§£å¿§ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#pragma omp parallel for collapse(2)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> y <span style="color:#f92672">=</span> k; y <span style="color:#f92672">&lt;</span> height <span style="color:#f92672">-</span> k; <span style="color:#f92672">++</span>y) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> k; x <span style="color:#f92672">&lt;</span> width <span style="color:#f92672">-</span> k; <span style="color:#f92672">++</span>x) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0f</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> dy <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>k; dy <span style="color:#f92672">&lt;=</span> k; <span style="color:#f92672">++</span>dy)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> dx <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>k; dx <span style="color:#f92672">&lt;=</span> k; <span style="color:#f92672">++</span>dx)
</span></span><span style="display:flex;"><span>                sum <span style="color:#f92672">+=</span> input[y <span style="color:#f92672">+</span> dy][x <span style="color:#f92672">+</span> dx] <span style="color:#f92672">*</span> kernel[k <span style="color:#f92672">+</span> dy][k <span style="color:#f92672">+</span> dx];
</span></span><span style="display:flex;"><span>        output[y][x] <span style="color:#f92672">=</span> sum;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="-è¯´æ˜">ğŸ§‚ è¯´æ˜ï¼š<a hidden class="anchor" aria-hidden="true" href="#-è¯´æ˜">#</a></h5>
<ul>
<li><code>collapse(2)</code>ï¼šæŠŠ <code>y-x</code> ä¸¤å±‚åˆå¹¶æˆä¸€ä¸ªå¤§ä»»åŠ¡å—ï¼Œæå‡çº¿ç¨‹åˆ©ç”¨ç‡ã€‚</li>
<li>æ— éœ€çº¿ç¨‹é—´é€šä¿¡ï¼Œå¤©ç„¶é€‚åˆå¹¶è¡Œã€‚</li>
</ul>
<hr>
<h4 id="-ä¸»èœç‚¹äº‘éå†æ‰¾æœ€å¤§é«˜åº¦">ğŸ§­ ä¸»èœï¼šç‚¹äº‘éå†æ‰¾æœ€å¤§é«˜åº¦<a hidden class="anchor" aria-hidden="true" href="#-ä¸»èœç‚¹äº‘éå†æ‰¾æœ€å¤§é«˜åº¦">#</a></h4>
<p>åœ¨ç‚¹äº‘ç®—æ³•ä¸­ï¼Œéå†å…¨åœºæ‰¾æœ€å¤§å€¼æ˜¯å®¶å¸¸ä¾¿é¥­ï¼Œç”¨ <code>reduction</code> ä¼˜é›…æ”¶å°¾ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#pragma omp parallel for reduction(max:max_val)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> cloud.size(); <span style="color:#f92672">++</span>i) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (cloud[i].z <span style="color:#f92672">&gt;</span> max_val)
</span></span><span style="display:flex;"><span>        max_val <span style="color:#f92672">=</span> cloud[i].z;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h5 id="-è¯´æ˜-1">ğŸ§‚ è¯´æ˜ï¼š<a hidden class="anchor" aria-hidden="true" href="#-è¯´æ˜-1">#</a></h5>
<ul>
<li><code>reduction(max:...)</code>ï¼šOpenMP è‡ªåŠ¨å¸®ä½ åšçº¿ç¨‹é—´æœ€å¤§å€¼åˆå¹¶ã€‚</li>
<li>æ¯”èµ·æ‰‹åŠ¨åŠ é”ï¼Œå¿«ä¸æ­¢ä¸€ç‚¹ç‚¹ã€‚</li>
</ul>
<hr>
<h4 id="-ç”œç‚¹ç»å…¸çŸ©é˜µä¹˜æ³•å¹¶è¡Œ">ğŸ§® ç”œç‚¹ï¼šç»å…¸çŸ©é˜µä¹˜æ³•å¹¶è¡Œ<a hidden class="anchor" aria-hidden="true" href="#-ç”œç‚¹ç»å…¸çŸ©é˜µä¹˜æ³•å¹¶è¡Œ">#</a></h4>
<p>çŸ©é˜µä¹˜æ³•æ˜¯æ•°å­¦è®¡ç®—é‡Œçš„è·‘åˆ†å¤§ä½¬ï¼Œä¸‰é‡å¾ªç¯ç»“æ„ï¼Œæ‹¿ä¸‹å®ƒæ€§èƒ½å°±èµ·é£ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#pragma omp parallel for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> M; <span style="color:#f92672">++</span>i)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> N; <span style="color:#f92672">++</span>j) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">float</span> sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0f</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; k <span style="color:#f92672">&lt;</span> K; <span style="color:#f92672">++</span>k)
</span></span><span style="display:flex;"><span>            sum <span style="color:#f92672">+=</span> A[i][k] <span style="color:#f92672">*</span> B[k][j];
</span></span><span style="display:flex;"><span>        C[i][j] <span style="color:#f92672">=</span> sum;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h5 id="-è¯´æ˜-2">ğŸ§‚ è¯´æ˜ï¼š<a hidden class="anchor" aria-hidden="true" href="#-è¯´æ˜-2">#</a></h5>
<ul>
<li>æˆ‘ä»¬åªå¹¶è¡Œæœ€å¤–å±‚ <code>i</code>ï¼Œç®€å•ç¨³å®šã€‚</li>
<li>æƒ³å†å‡çº§ï¼Ÿå¯ä»¥å°è¯•ç¼“å­˜ä¼˜åŒ– + SIMD æŒ‡ä»¤ã€‚</li>
</ul>
<hr>
<h4 id="-ç¼–è¯‘æ–¹æ³•gcc-or-clang">ğŸ”¨ ç¼–è¯‘æ–¹æ³•ï¼ˆGCC or Clangï¼‰<a hidden class="anchor" aria-hidden="true" href="#-ç¼–è¯‘æ–¹æ³•gcc-or-clang">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>g++ your_code.cpp -fopenmp -O3 -o run
</span></span></code></pre></div><p>âœ… æ³¨æ„ <code>-fopenmp</code> æ˜¯æ‰“å¼€å¹¶è¡Œä¸–ç•Œå¤§é—¨çš„é’¥åŒ™ã€‚</p>
<hr>
<h4 id="-æ€§èƒ½æµ‹è¯•å»ºè®®">ğŸ“ˆ æ€§èƒ½æµ‹è¯•å»ºè®®<a hidden class="anchor" aria-hidden="true" href="#-æ€§èƒ½æµ‹è¯•å»ºè®®">#</a></h4>
<table>
  <thead>
      <tr>
          <th>æ¨¡å—</th>
          <th>æµ‹è¯•æ–¹å¼</th>
          <th>è§‚æµ‹æŒ‡æ ‡</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>å›¾åƒå·ç§¯</td>
          <td>å¤§å°ºå¯¸å›¾+é«˜æ–¯æ ¸</td>
          <td>é€Ÿåº¦æå‡å€æ•°</td>
      </tr>
      <tr>
          <td>ç‚¹äº‘éå†</td>
          <td>ä¸Šç™¾ä¸‡ç‚¹</td>
          <td>æœ€å¤§å€¼æå–æ—¶é—´</td>
      </tr>
      <tr>
          <td>çŸ©é˜µä¹˜æ³•</td>
          <td>æ–¹é˜µä¹˜æ³•ï¼ˆå¦‚1024Ã—1024ï¼‰</td>
          <td>GFLOPS æˆ–è€—æ—¶å¯¹æ¯”</td>
      </tr>
  </tbody>
</table>
<hr>
<h4 id="-æ€»ç»“ä¸€å¥è¯">ğŸ§  æ€»ç»“ä¸€å¥è¯<a hidden class="anchor" aria-hidden="true" href="#-æ€»ç»“ä¸€å¥è¯">#</a></h4>
<blockquote>
<p>OpenMP å°±åƒä¸€é“é­”æ³•æŒ‡ä»¤èœè°±ï¼šåŠ ç‚¹ <code>#pragma</code>ï¼Œè®©ä½ çš„ç¨‹åºä»å•æ ¸å°æ¿å‡³ï¼Œä¸€è·ƒä¸Šå¤šæ ¸æ“‚å°ã€‚</p></blockquote>
<h2 id="tbb">TBB<a hidden class="anchor" aria-hidden="true" href="#tbb">#</a></h2>
<h3 id="-tbb-æ˜¯ä»€ä¹ˆ">ğŸ© TBB æ˜¯ä»€ä¹ˆï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-tbb-æ˜¯ä»€ä¹ˆ">#</a></h3>
<p>Intel Threading Building Blocksï¼ˆTBBï¼‰æ˜¯ Intel å¼€å‘çš„ä¸€ä¸ª <strong>ä»»åŠ¡è°ƒåº¦ + æ•°æ®å¹¶è¡Œ + æµæ°´çº¿å¹¶è¡Œ + é€šç”¨ç®—æ³•åº“</strong>ï¼Œæ—¨åœ¨è®©ä½ åœ¨ C++ ä»£ç ä¸­è½»æ¾å†™å‡ºå¤šçº¿ç¨‹ç¨‹åºï¼Œ<strong>ä¸ç”¨å…³å¿ƒçº¿ç¨‹åˆ›å»ºã€é”€æ¯ã€è°ƒåº¦ç­‰ä½å±‚çäº‹</strong>ã€‚</p>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<blockquote>
<p><strong>â€œæˆ‘ä¸å…³å¿ƒçº¿ç¨‹ï¼Œæˆ‘åªå…³å¿ƒæˆ‘æ‰‹ä¸Šçš„å·¥ä½œï¼ˆtaskï¼‰ã€‚â€</strong></p></blockquote>
<hr>
<h3 id="-tbb-æœ‰ä»€ä¹ˆå‰å®³çš„">ğŸ”§ TBB æœ‰ä»€ä¹ˆå‰å®³çš„ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-tbb-æœ‰ä»€ä¹ˆå‰å®³çš„">#</a></h3>
<table>
  <thead>
      <tr>
          <th>èƒ½åŠ›</th>
          <th>è¯´æ˜</th>
          <th>å¯¹æ ‡</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>parallel_for</code></td>
          <td>å¹¶è¡Œå¾ªç¯ï¼Œè‡ªåŠ¨ä»»åŠ¡åˆ’åˆ†</td>
          <td>OpenMP for</td>
      </tr>
      <tr>
          <td><code>parallel_reduce</code></td>
          <td>å¹¶è¡Œå½’çº¦ï¼ˆåŠ å’Œã€æœ€å¤§ç­‰ï¼‰</td>
          <td>OpenMP reduction</td>
      </tr>
      <tr>
          <td><code>flow::graph</code></td>
          <td>å¹¶è¡Œå›¾è°ƒåº¦ï¼ˆè¶…å¼ºï¼‰</td>
          <td>ç±»ä¼¼äº task DAG</td>
      </tr>
      <tr>
          <td><code>concurrent_*</code></td>
          <td>å¹¶å‘å®¹å™¨ï¼ˆå“ˆå¸Œè¡¨ã€é˜Ÿåˆ—ç­‰ï¼‰</td>
          <td>æ— éœ€åŠ é”</td>
      </tr>
      <tr>
          <td><code>task_group</code></td>
          <td>ç±»ä¼¼ <code>std::async</code> + <code>future</code></td>
          <td><code>std::thread</code> å‡çº§ç‰ˆ</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-å°èœä¸Šæ¡Œtbb-å¹¶è¡Œç¤ºä¾‹ä¸‰é“">ğŸ± å°èœä¸Šæ¡Œï¼šTBB å¹¶è¡Œç¤ºä¾‹ä¸‰é“<a hidden class="anchor" aria-hidden="true" href="#-å°èœä¸Šæ¡Œtbb-å¹¶è¡Œç¤ºä¾‹ä¸‰é“">#</a></h3>
<hr>
<h4 id="-ç¤ºä¾‹-1å¹¶è¡Œ-for-å¤„ç†æ•°ç»„">ğŸ¥— ç¤ºä¾‹ 1ï¼šå¹¶è¡Œ <code>for</code> å¤„ç†æ•°ç»„<a hidden class="anchor" aria-hidden="true" href="#-ç¤ºä¾‹-1å¹¶è¡Œ-for-å¤„ç†æ•°ç»„">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;tbb/parallel_for.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">float</span><span style="color:#f92672">&gt;</span> arr(<span style="color:#ae81ff">1e6</span>, <span style="color:#ae81ff">1.0f</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    tbb<span style="color:#f92672">::</span>parallel_for(<span style="color:#ae81ff">0</span>, (<span style="color:#66d9ef">int</span>)arr.size(), [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">int</span> i) {
</span></span><span style="display:flex;"><span>        arr[i] <span style="color:#f92672">*=</span> <span style="color:#ae81ff">2.0f</span>; <span style="color:#75715e">// æ¯ä¸ªå…ƒç´ ä¹˜2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;arr[42] = &#34;</span> <span style="color:#f92672">&lt;&lt;</span> arr[<span style="color:#ae81ff">42</span>] <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ğŸ§  TBB è‡ªåŠ¨æŠŠå¾ªç¯æ‹†æˆ taskï¼Œè°ƒåº¦åˆ°å„æ ¸ä¸Šï¼Œ<strong>ä½ åªå†™ for ä½“å°±è¡Œ</strong>ï¼Œçº¿ç¨‹æ•°è‡ªå·±è°ƒèŠ‚ã€‚</p>
<hr>
<h4 id="-ç¤ºä¾‹-2å¹¶è¡ŒçŸ©é˜µåŠ æ³•">ğŸ§® ç¤ºä¾‹ 2ï¼šå¹¶è¡ŒçŸ©é˜µåŠ æ³•<a hidden class="anchor" aria-hidden="true" href="#-ç¤ºä¾‹-2å¹¶è¡ŒçŸ©é˜µåŠ æ³•">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;tbb/parallel_for.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">mat_add</span>(<span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">float</span><span style="color:#f92672">&gt;&gt;&amp;</span> A,
</span></span><span style="display:flex;"><span>             <span style="color:#66d9ef">const</span> std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">float</span><span style="color:#f92672">&gt;&gt;&amp;</span> B,
</span></span><span style="display:flex;"><span>             std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span>std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">float</span><span style="color:#f92672">&gt;&gt;&amp;</span> C) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> M <span style="color:#f92672">=</span> A.size(), N <span style="color:#f92672">=</span> A[<span style="color:#ae81ff">0</span>].size();
</span></span><span style="display:flex;"><span>    tbb<span style="color:#f92672">::</span>parallel_for(<span style="color:#ae81ff">0</span>, M, [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">int</span> i) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> N; <span style="color:#f92672">++</span>j)
</span></span><span style="display:flex;"><span>            C[i][j] <span style="color:#f92672">=</span> A[i][j] <span style="color:#f92672">+</span> B[i][j];
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ğŸ”¥ é€‚åˆå¤§è§„æ¨¡çŸ©é˜µæ“ä½œï¼Œä¸ç”¨æ‰‹åŠ¨æ‹†ä»»åŠ¡ã€‚</p>
<hr>
<h4 id="-ç¤ºä¾‹-3parallel_reduce-å¹¶è¡ŒåŠ å’Œ">ğŸ§  ç¤ºä¾‹ 3ï¼š<code>parallel_reduce</code> å¹¶è¡ŒåŠ å’Œ<a hidden class="anchor" aria-hidden="true" href="#-ç¤ºä¾‹-3parallel_reduce-å¹¶è¡ŒåŠ å’Œ">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;tbb/parallel_reduce.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;tbb/blocked_range.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">float</span><span style="color:#f92672">&gt;</span> vec(<span style="color:#ae81ff">1e6</span>, <span style="color:#ae81ff">1.0f</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> sum <span style="color:#f92672">=</span> tbb<span style="color:#f92672">::</span>parallel_reduce(
</span></span><span style="display:flex;"><span>        tbb<span style="color:#f92672">::</span>blocked_range<span style="color:#f92672">&lt;</span>size_t<span style="color:#f92672">&gt;</span>(<span style="color:#ae81ff">0</span>, vec.size()),
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0.0f</span>,
</span></span><span style="display:flex;"><span>        [<span style="color:#f92672">&amp;</span>](tbb<span style="color:#f92672">::</span>blocked_range<span style="color:#f92672">&lt;</span>size_t<span style="color:#f92672">&gt;</span> r, <span style="color:#66d9ef">float</span> local_sum) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (size_t i <span style="color:#f92672">=</span> r.begin(); i <span style="color:#f92672">&lt;</span> r.end(); <span style="color:#f92672">++</span>i)
</span></span><span style="display:flex;"><span>                local_sum <span style="color:#f92672">+=</span> vec[i];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> local_sum;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>plus<span style="color:#f92672">&lt;&gt;</span>()
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Sum = &#34;</span> <span style="color:#f92672">&lt;&lt;</span> sum <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>â˜• <code>parallel_reduce</code> æ˜¯å¹¶è¡ŒåŠ æ€»çš„ä¼˜é›…èŒƒå¼ï¼Œ<strong>å±€éƒ¨å’Œ â†’ åˆå¹¶å™¨ï¼ˆå¦‚ std::plusï¼‰</strong>ã€‚</p>
<hr>
<h3 id="-ç¼–è¯‘æ–¹å¼gcc--intel-oneapi-æˆ–ç³»ç»Ÿtbb">ğŸ§° ç¼–è¯‘æ–¹å¼ï¼ˆGCC + Intel OneAPI æˆ–ç³»ç»ŸTBBï¼‰<a hidden class="anchor" aria-hidden="true" href="#-ç¼–è¯‘æ–¹å¼gcc--intel-oneapi-æˆ–ç³»ç»Ÿtbb">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>g++ your_code.cpp -ltbb -O3 -o run
</span></span></code></pre></div><hr>
<h3 id="-tbb-ä¼˜åŠ¿åœ¨å“ª">ğŸš€ TBB ä¼˜åŠ¿åœ¨å“ªï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-tbb-ä¼˜åŠ¿åœ¨å“ª">#</a></h3>
<table>
  <thead>
      <tr>
          <th>ç‰¹æ€§</th>
          <th>OpenMP</th>
          <th>TBB</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ä»»åŠ¡è°ƒåº¦</td>
          <td>é™æ€ã€ç¼–è¯‘æœŸ</td>
          <td>åŠ¨æ€ã€è¿è¡Œæ—¶</td>
      </tr>
      <tr>
          <td>çµæ´»æ€§</td>
          <td>é«˜ï¼ˆä½†åç»“æ„åŒ–ï¼‰</td>
          <td><strong>æé«˜</strong>ï¼Œé€‚åˆå¤æ‚ä¾èµ–</td>
      </tr>
      <tr>
          <td>å¯ç»„åˆæ€§</td>
          <td>å·®</td>
          <td><strong>å¼º</strong>ï¼Œæ”¯æŒåµŒå¥—è°ƒåº¦</td>
      </tr>
      <tr>
          <td>æ³›ç”¨æ€§</td>
          <td>ä¸­ç­‰</td>
          <td><strong>é«˜</strong>ï¼Œæ”¯æŒä»»åŠ¡å›¾ç­‰å¤æ‚æ¨¡å‹</td>
      </tr>
      <tr>
          <td>æ”¯æŒå®¹å™¨</td>
          <td>æ— </td>
          <td><code>concurrent_vector</code> ç­‰åŸç”Ÿå¹¶å‘å®¹å™¨</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-åº”ç”¨åœºæ™¯å…¸å‹ç”¨æ³•">ğŸ’¡ åº”ç”¨åœºæ™¯å…¸å‹ç”¨æ³•<a hidden class="anchor" aria-hidden="true" href="#-åº”ç”¨åœºæ™¯å…¸å‹ç”¨æ³•">#</a></h3>
<ul>
<li>å›¾ç¥ç»ç½‘ç»œå¤šé˜¶æ®µè°ƒåº¦ï¼ˆTBB Flow Graphï¼‰</li>
<li>è§†è§‰ SLAM ä¸­å¸§å¹¶è¡Œæˆ–åœ°å›¾ä»»åŠ¡è°ƒåº¦</li>
<li>ç‚¹äº‘å—çº§å¤„ç†ï¼ˆæ¯”å¦‚ voxel gridï¼‰</li>
<li>å¤§å‹çŸ©é˜µ/å¼ é‡/ç¨€ç–å›¾å¤„ç†</li>
<li>CPU ç«¯è½»é‡ä»»åŠ¡æµæ°´çº¿</li>
</ul>
<hr>
<h3 id="-want-more">ğŸ§ª Want More?<a hidden class="anchor" aria-hidden="true" href="#-want-more">#</a></h3>
<p>å¦‚æœä½ æƒ³æ·±å…¥ TBBï¼Œå¯ä»¥ä»è¿™äº›å¼€å§‹ï¼š</p>
<ul>
<li><code>tbb::flow::graph</code>ï¼šæ„å»ºå¹¶è¡Œä»»åŠ¡å›¾ï¼Œåƒå†™ç¥ç»ç½‘ç»œé‚£æ ·è°ƒåº¦ä»»åŠ¡</li>
<li><code>tbb::task_arena</code>ï¼šä»»åŠ¡éš”ç¦»ä¸ç»‘å®šçº¿ç¨‹</li>
<li><code>tbb::concurrent_hash_map</code>ï¼šçº¿ç¨‹å®‰å…¨å®¹å™¨ï¼Œåª²ç¾ Java ConcurrentHashMap</li>
<li>è‡ªå®šä¹‰ä»»åŠ¡è°ƒåº¦å™¨ç­–ç•¥ï¼ˆæ¯”å¦‚ affinityï¼‰</li>
</ul>
<h2 id="c-thread">C++ thread<a hidden class="anchor" aria-hidden="true" href="#c-thread">#</a></h2>
<p>é‚£å°±æŠŠè€ä¸‰è¯·ä¸Šå°ï¼š<strong>C++ Standard Thread Library</strong>ï¼Œä¹Ÿå°±æ˜¯ <code>std::thread</code> â€”â€” <strong>çº¿ç¨‹ç•Œçš„åŸæ•™æ—¨ä¸»ä¹‰è€…</strong>ï¼Œä¸åƒ OpenMP å’Œ TBB é‚£æ ·æœ‰èŠ±é‡Œèƒ¡å“¨çš„å®æˆ–è°ƒåº¦å™¨ï¼Œå®ƒå°±æ˜¯ï¼š</p>
<blockquote>
<p>â€œä½ è¦å‡ æ ¹çº¿ç¨‹ï¼Œæˆ‘ç»™ä½ å¼€å‡ æ ¹ã€‚â€</p></blockquote>
<p>ğŸŒªï¸ ç®€å•ç²—æš´ã€ç¡¬æ ¸ç›´ç™½ï¼Œé€‚åˆä½ æƒ³äº²æ‰‹æ“åˆ€å¤šçº¿ç¨‹è°ƒåº¦çš„åœºæ™¯ï¼Œ<strong>åŒæ—¶ä¹Ÿå®¹æ˜“å†™å‡ºçº¿ç¨‹åœ°ç‹±ï¼ˆthread hellï¼‰</strong>ã€‚</p>
<hr>
<h3 id="-stdthread-æ˜¯ä»€ä¹ˆ">ğŸ› ï¸ <code>std::thread</code> æ˜¯ä»€ä¹ˆï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-stdthread-æ˜¯ä»€ä¹ˆ">#</a></h3>
<p>æ˜¯ C++11 å¼•å…¥çš„æ ‡å‡†åº“ç»„ä»¶ï¼Œç”¨äºç›´æ¥åˆ›å»ºå’Œæ§åˆ¶çº¿ç¨‹ã€‚ä½ å¯ä»¥ï¼š</p>
<ul>
<li>å¯åŠ¨æ–°çº¿ç¨‹è·‘å‡½æ•°</li>
<li>ä¼ å‚</li>
<li>ç­‰å¾…çº¿ç¨‹ï¼ˆ<code>join</code>ï¼‰</li>
<li>åˆ†ç¦»çº¿ç¨‹ï¼ˆ<code>detach</code>ï¼‰</li>
<li>é…åˆ <code>mutex</code>, <code>condition_variable</code>, <code>future</code> ç­‰å†™æ›´å¤æ‚çš„åŒæ­¥</li>
</ul>
<hr>
<h3 id="-åŸºæœ¬ç”¨æ³•ç¤ºä¾‹ä¸€è§ˆ">ğŸ§ª åŸºæœ¬ç”¨æ³•ç¤ºä¾‹ä¸€è§ˆ<a hidden class="anchor" aria-hidden="true" href="#-åŸºæœ¬ç”¨æ³•ç¤ºä¾‹ä¸€è§ˆ">#</a></h3>
<h4 id="-ç¤ºä¾‹-1å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹">ğŸŒ± ç¤ºä¾‹ 1ï¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹<a hidden class="anchor" aria-hidden="true" href="#-ç¤ºä¾‹-1å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;thread&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">hello</span>() {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Hello from thread!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span><span style="color:#66d9ef">thread</span> t(hello);
</span></span><span style="display:flex;"><span>    t.join(); <span style="color:#75715e">// ç­‰å¾…çº¿ç¨‹ç»“æŸ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><hr>
<h4 id="-ç¤ºä¾‹-2å¤šçº¿ç¨‹åŠ é€Ÿå¾ªç¯å¤„ç†">ğŸ ç¤ºä¾‹ 2ï¼šå¤šçº¿ç¨‹åŠ é€Ÿå¾ªç¯å¤„ç†<a hidden class="anchor" aria-hidden="true" href="#-ç¤ºä¾‹-2å¤šçº¿ç¨‹åŠ é€Ÿå¾ªç¯å¤„ç†">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;thread&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">double_range</span>(std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">float</span><span style="color:#f92672">&gt;&amp;</span> arr, <span style="color:#66d9ef">int</span> start, <span style="color:#66d9ef">int</span> end) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> start; i <span style="color:#f92672">&lt;</span> end; <span style="color:#f92672">++</span>i)
</span></span><span style="display:flex;"><span>        arr[i] <span style="color:#f92672">*=</span> <span style="color:#ae81ff">2.0f</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">float</span><span style="color:#f92672">&gt;</span> arr(<span style="color:#ae81ff">1e6</span>, <span style="color:#ae81ff">1.0f</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> mid <span style="color:#f92672">=</span> arr.size() <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span><span style="color:#66d9ef">thread</span> t1(double_range, std<span style="color:#f92672">::</span>ref(arr), <span style="color:#ae81ff">0</span>, mid);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span><span style="color:#66d9ef">thread</span> t2(double_range, std<span style="color:#f92672">::</span>ref(arr), mid, arr.size());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    t1.join();
</span></span><span style="display:flex;"><span>    t2.join();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;arr[42] = &#34;</span> <span style="color:#f92672">&lt;&lt;</span> arr[<span style="color:#ae81ff">42</span>] <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ğŸ§  <code>std::ref(arr)</code> æ˜¯é‡ç‚¹ â€”â€” ä½ å¾—æ˜¾å¼å‘Šè¯‰çº¿ç¨‹ä¼ çš„æ˜¯å¼•ç”¨ï¼Œä¸ç„¶å°±å¤åˆ¶è¿‡å»äº†ï¼</p>
<hr>
<h4 id="-ç¤ºä¾‹-3future--async-è‡ªåŠ¨çº¿ç¨‹æ± ">ğŸŒŸ ç¤ºä¾‹ 3ï¼šfuture + async è‡ªåŠ¨çº¿ç¨‹æ± <a hidden class="anchor" aria-hidden="true" href="#-ç¤ºä¾‹-3future--async-è‡ªåŠ¨çº¿ç¨‹æ± ">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;future&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">compute</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">6</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">7</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>future<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> result <span style="color:#f92672">=</span> std<span style="color:#f92672">::</span>async(std<span style="color:#f92672">::</span>launch<span style="color:#f92672">::</span>async, compute);
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Result: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> result.get() <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ğŸ”® ç”¨ <code>std::async</code> å¯ä»¥è‡ªåŠ¨å¯çº¿ç¨‹ï¼Œç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œè¿˜èƒ½å¾—åˆ°ç»“æœï¼Œ<strong>è½»é‡åˆé«˜ç«¯</strong>ã€‚</p>
<hr>
<h3 id="-ä¼˜åŠ¿ä¸å±€é™">ğŸ’¬ ä¼˜åŠ¿ä¸å±€é™ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-ä¼˜åŠ¿ä¸å±€é™">#</a></h3>
<table>
  <thead>
      <tr>
          <th>ç‰¹æ€§</th>
          <th><code>std::thread</code></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>æ§åˆ¶åŠ›</td>
          <td>âœ… ç»å¯¹è‡ªç”±ï¼Œä½ æŒæ¡ä¸€åˆ‡</td>
      </tr>
      <tr>
          <td>å­¦ä¹ æ›²çº¿</td>
          <td>ğŸš¨ æœ‰ç‚¹é™¡ï¼Œè¦æ‰‹åŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€åŒæ­¥</td>
      </tr>
      <tr>
          <td>é€‚åˆåœºæ™¯</td>
          <td>âœ… å°è§„æ¨¡çº¿ç¨‹ã€ç³»ç»Ÿçº§åˆ«ä»»åŠ¡ã€æ•™å­¦</td>
      </tr>
      <tr>
          <td>ä¸é€‚åˆ</td>
          <td>ğŸš« å¤§è§„æ¨¡å¹¶è¡Œå¤„ç†ï¼ˆä½ ä¸æƒ³è‡ªå·±å†™çº¿ç¨‹æ± ï¼‰</td>
      </tr>
      <tr>
          <td>æ¨èç”¨æ³•</td>
          <td>âœ… <code>std::async</code> + <code>future</code> ç»„åˆç”¨</td>
      </tr>
      <tr>
          <td>çº¿ç¨‹æ± ï¼Ÿ</td>
          <td>âŒ åŸç”Ÿæ²¡æœ‰ï¼Œå¾—ç”¨ç¬¬ä¸‰æ–¹åº“æˆ–è‡ªå·±å†™</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-ä»€ä¹ˆåœºæ™¯é€‚åˆ-stdthread">ğŸ§  ä»€ä¹ˆåœºæ™¯é€‚åˆ <code>std::thread</code>ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-ä»€ä¹ˆåœºæ™¯é€‚åˆ-stdthread">#</a></h3>
<ul>
<li>å†™ä¸€ä¸ªçº¿ç¨‹ç›‘å¬é”®ç›˜/ç½‘ç»œäº‹ä»¶</li>
<li>ç®€å•åŒçº¿ç¨‹åŠ é€Ÿï¼ˆæ¯”å¦‚ SLAM åŒçº¿ç¨‹ä¼˜åŒ–+è·Ÿè¸ªï¼‰</li>
<li>æ§åˆ¶ç²’åº¦å¾ˆç»†çš„å¤šçº¿ç¨‹ç³»ç»Ÿ</li>
<li>å®ç°è‡ªå·±çš„ä»»åŠ¡è°ƒåº¦å™¨æˆ–çº¿ç¨‹æ± </li>
</ul>
<hr>
<h3 id="-c-çº¿ç¨‹ç”Ÿæ€è¡¥å…¨é€‰é¡¹">ğŸ”© C++ çº¿ç¨‹ç”Ÿæ€è¡¥å…¨é€‰é¡¹<a hidden class="anchor" aria-hidden="true" href="#-c-çº¿ç¨‹ç”Ÿæ€è¡¥å…¨é€‰é¡¹">#</a></h3>
<table>
  <thead>
      <tr>
          <th>ç”¨é€”</th>
          <th>æ¨èåº“</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>çº¿ç¨‹æ± </td>
          <td><code>BS::thread_pool</code>, <code>ctpl</code>, <code>asio::thread_pool</code></td>
      </tr>
      <tr>
          <td>å¹¶å‘é˜Ÿåˆ—</td>
          <td><code>moodycamel::ConcurrentQueue</code></td>
      </tr>
      <tr>
          <td>åç¨‹é£æ ¼</td>
          <td><code>C++20 coroutine</code>, <code>libgo</code>, <code>cppcoro</code></td>
      </tr>
      <tr>
          <td>Actor æ¨¡å‹</td>
          <td><code>CAF</code>, <code>SObjectizer</code></td>
      </tr>
      <tr>
          <td>åˆ†å¸ƒå¼çº¿ç¨‹æ± </td>
          <td><code>Ray</code>, <code>HPX</code></td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-ç¼–è¯‘æ–¹æ³•">ğŸ“¦ ç¼–è¯‘æ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#-ç¼–è¯‘æ–¹æ³•">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>g++ my_thread.cpp -std<span style="color:#f92672">=</span>c++11 -pthread -O2 -o run
</span></span></code></pre></div><p>ä¸€å®šè®°å¾— <code>-pthread</code>ï¼Œä¸ç„¶ä½ ä¼šæ”¶åˆ°â€œçº¿ç¨‹ä¸å­˜åœ¨â€çš„æ¸©æŸ”é—®å€™ ğŸ§¨</p>
<hr>
<h3 id="-æ€»ç»“é‡‘å¥è­¦å‘Š">ğŸš€ æ€»ç»“ï¼ˆé‡‘å¥è­¦å‘Šï¼‰<a hidden class="anchor" aria-hidden="true" href="#-æ€»ç»“é‡‘å¥è­¦å‘Š">#</a></h3>
<blockquote>
<p><code>std::thread</code> æ˜¯ä¸€æŠŠå¼€å±±åˆ€ï¼Œé€‚åˆä½ ä»é›¶æ­å»ºå¹¶å‘ç³»ç»Ÿã€‚<br>
ä½†å¦‚æœä½ åªæƒ³ç‚’èœï¼Œ<strong>OpenMP æ˜¯ç”µç£ç‚‰ï¼ŒTBB æ˜¯æ–™ç†æœºï¼ŒThread æ˜¯åŠˆæŸ´åˆ€</strong>ã€‚</p></blockquote>
<h2 id="cuda">CUDA<a hidden class="anchor" aria-hidden="true" href="#cuda">#</a></h2>
<p>CUDAï¼ˆCompute Unified Device Architectureï¼‰â€”â€”è¿™åå­—å¬èµ·æ¥å°±åƒæ˜¯â€œæ˜¾å¡ç•Œçš„é»‘é­”æ³•â€ï¼Œå®åˆ™æ˜¯ <strong>NVIDIA å¼€å‘çš„ä¸€ç§å¹¶è¡Œè®¡ç®—å¹³å°ä¸ç¼–ç¨‹æ¨¡å‹</strong>ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç”¨ C/C++ å†™å‡ºè·‘åœ¨ GPU ä¸Šçš„ä»£ç ã€‚</p>
<p>ç”¨å¤§ç™½è¯è¯´ï¼š</p>
<blockquote>
<p><strong>CUDA æ˜¯ä½ æå‡ºæ˜¾å¡é‡Œå‡ åƒä¸ªæ ¸å¿ƒæ¥è·‘å¹¶è¡Œä»»åŠ¡çš„é’¥åŒ™ã€‚</strong></p></blockquote>
<hr>
<h3 id="-cuda-æ˜¯å¹²å•¥çš„">ğŸ”© CUDA æ˜¯å¹²å•¥çš„ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-cuda-æ˜¯å¹²å•¥çš„">#</a></h3>
<ul>
<li>æŠŠæ•°æ®æ‰”åˆ° GPU</li>
<li>å¹²ä¸€å †å¹¶è¡Œè¿ç®—ï¼ˆæ¯”å¦‚å›¾åƒå¤„ç†ã€æ·±åº¦å­¦ä¹ ã€çŸ©é˜µä¹˜æ³•ã€ç²’å­æ¨¡æ‹Ÿï¼‰</li>
<li>æŠŠç»“æœæ‹½å›æ¥</li>
</ul>
<p>ä½ å†™ä¸ª kernel å‡½æ•°ï¼Œæ˜¾å¡ä¸Šå‡ åƒä¸ªçº¿ç¨‹å°±èƒ½åŒæ—¶æ‰§è¡Œå®ƒï¼Œ<strong>å ªç§°ç§‘å­¦è®¡ç®—ç•Œçš„é£ç«è½®ğŸŒ€</strong></p>
<hr>
<h3 id="-cuda-ç¼–ç¨‹æ¨¡å‹å¿«è§ˆ">âš™ï¸ CUDA ç¼–ç¨‹æ¨¡å‹å¿«è§ˆ<a hidden class="anchor" aria-hidden="true" href="#-cuda-ç¼–ç¨‹æ¨¡å‹å¿«è§ˆ">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>__global__ <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>b, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>c) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> idx <span style="color:#f92672">=</span> threadIdx.x;
</span></span><span style="display:flex;"><span>    c[idx] <span style="color:#f92672">=</span> a[idx] <span style="color:#f92672">+</span> b[idx];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> a[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>};
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> b[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">50</span>};
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> c[<span style="color:#ae81ff">5</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>d_a, <span style="color:#f92672">*</span>d_b, <span style="color:#f92672">*</span>d_c;
</span></span><span style="display:flex;"><span>    cudaMalloc(<span style="color:#f92672">&amp;</span>d_a, <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));
</span></span><span style="display:flex;"><span>    cudaMalloc(<span style="color:#f92672">&amp;</span>d_b, <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));
</span></span><span style="display:flex;"><span>    cudaMalloc(<span style="color:#f92672">&amp;</span>d_c, <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cudaMemcpy(d_a, a, <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>), cudaMemcpyHostToDevice);
</span></span><span style="display:flex;"><span>    cudaMemcpy(d_b, b, <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>), cudaMemcpyHostToDevice);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    add<span style="color:#f92672">&lt;&lt;&lt;</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">&gt;&gt;&gt;</span>(d_a, d_b, d_c);  <span style="color:#75715e">// &lt;&lt;&lt;blocks, threads&gt;&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    cudaMemcpy(c, d_c, <span style="color:#ae81ff">5</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>), cudaMemcpyDeviceToHost);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">5</span>; <span style="color:#f92672">++</span>i)
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> c[i] <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; &#34;</span>;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cudaFree(d_a); cudaFree(d_b); cudaFree(d_c);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h3 id="-è§£é‡Šä¸€ä¸‹é‡Œé¢çš„é»‘è¯">âœ¨ è§£é‡Šä¸€ä¸‹é‡Œé¢çš„é»‘è¯ï¼š<a hidden class="anchor" aria-hidden="true" href="#-è§£é‡Šä¸€ä¸‹é‡Œé¢çš„é»‘è¯">#</a></h3>
<table>
  <thead>
      <tr>
          <th>ä¸œè¥¿</th>
          <th>æ˜¯å•¥æ„æ€</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>__global__</code></td>
          <td>å£°æ˜å‡½æ•°æ˜¯ GPU ä¸Šè·‘çš„ kernel</td>
      </tr>
      <tr>
          <td><code>cudaMalloc</code></td>
          <td>åœ¨ GPU ä¸Šåˆ†é…å†…å­˜</td>
      </tr>
      <tr>
          <td><code>cudaMemcpy</code></td>
          <td>ä¸»æœº â†” è®¾å¤‡ å¤åˆ¶æ•°æ®</td>
      </tr>
      <tr>
          <td><code>add&lt;&lt;&lt;1, 5&gt;&gt;&gt;</code></td>
          <td>å¯åŠ¨ 1 ä¸ª blockï¼Œæ¯ block å« 5 ä¸ªçº¿ç¨‹</td>
      </tr>
      <tr>
          <td><code>threadIdx.x</code></td>
          <td>å½“å‰çº¿ç¨‹åœ¨çº¿ç¨‹å—å†…çš„ç´¢å¼•</td>
      </tr>
      <tr>
          <td><code>cudaFree</code></td>
          <td>æ˜¾å¡ä¸Šé‡Šæ”¾å†…å­˜èµ„æº</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-ä½ èƒ½ç”¨-cuda-åšå•¥">ğŸš€ ä½ èƒ½ç”¨ CUDA åšå•¥ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-ä½ èƒ½ç”¨-cuda-åšå•¥">#</a></h3>
<table>
  <thead>
      <tr>
          <th>åœºæ™¯</th>
          <th>ç”¨æ³•</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>å›¾åƒå¤„ç†</td>
          <td>ç°åº¦åŒ–ã€æ»¤æ³¢ã€å·ç§¯</td>
      </tr>
      <tr>
          <td>3D ç‚¹äº‘</td>
          <td>å¤§è§„æ¨¡ç‚¹é‚»åŸŸæŸ¥æ‰¾ã€Voxel Grid</td>
      </tr>
      <tr>
          <td>æ•°å€¼è®¡ç®—</td>
          <td>ç¨€ç–çŸ©é˜µè¿ç®—ã€FFTã€æ±‚å¯¼</td>
      </tr>
      <tr>
          <td>æ·±åº¦å­¦ä¹ </td>
          <td>Tensor æ“ä½œã€åå‘ä¼ æ’­ï¼ˆPyTorch èƒŒåå°±æ˜¯ CUDAï¼‰</td>
      </tr>
      <tr>
          <td>SLAM</td>
          <td>Dense Mappingã€Scan Matching</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-cuda-å¼€å‘è€…çš„-daily-life">ğŸ’¡ CUDA å¼€å‘è€…çš„ daily life<a hidden class="anchor" aria-hidden="true" href="#-cuda-å¼€å‘è€…çš„-daily-life">#</a></h3>
<p>ä½ å¾—å…³å¿ƒï¼š</p>
<ul>
<li>å†…å­˜è®¿é—®æ˜¯å¦ coalescedï¼ˆåˆå¹¶è®¿é—®å¿«ï¼‰</li>
<li>æ¯ä¸ª thread åšä»€ä¹ˆï¼Œblock çš„åˆ’åˆ†æ€ä¹ˆåˆ†</li>
<li>æ˜¾å­˜ copy æˆæœ¬æ˜¯å¦å€¼å¾—</li>
<li>bank conflictã€warp divergenceï¼ˆçº¿ç¨‹è·‘å¾—ä¸æ•´é½å°±æµªè´¹ï¼‰</li>
<li>æ˜¯å¦ç”¨ shared memory åšç¼“å­˜ï¼ˆå’Œ L1 ç±»ä¼¼ï¼‰</li>
</ul>
<p>è¿™æ˜¯â€œæ•°æ®å¹¶è¡Œâ€å’Œâ€œç¡¬ä»¶å‹å¥½â€çš„è‰ºæœ¯ âœ¨</p>
<hr>
<h3 id="-ç¼–è¯‘æ–¹å¼">ğŸ”§ ç¼–è¯‘æ–¹å¼ï¼š<a hidden class="anchor" aria-hidden="true" href="#-ç¼–è¯‘æ–¹å¼">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nvcc my_cuda_program.cu -o my_prog
</span></span></code></pre></div><p>ä½ å°±èƒ½å¾—åˆ°ä¸€ä¸ª GPU åŠ é€Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶å•¦ï¼</p>
<hr>
<h3 id="-å­¦-cuda-éœ€è¦å‡†å¤‡ç‚¹å•¥">ğŸ§  å­¦ CUDA éœ€è¦å‡†å¤‡ç‚¹å•¥ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-å­¦-cuda-éœ€è¦å‡†å¤‡ç‚¹å•¥">#</a></h3>
<table>
  <thead>
      <tr>
          <th>é¡¹ç›®</th>
          <th>æ¨è</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ç¼–ç¨‹è¯­è¨€</td>
          <td>ç†Ÿæ‚‰ C/C++</td>
      </tr>
      <tr>
          <td>åŸºç¡€çŸ¥è¯†</td>
          <td>å¹¶è¡Œè®¡ç®—æ¨¡å‹ã€å†…å­˜å¸ƒå±€ã€çº¿ç¨‹</td>
      </tr>
      <tr>
          <td>å·¥å…·é“¾</td>
          <td>NVIDIA æ˜¾å¡ã€é©±åŠ¨ã€CUDA Toolkit</td>
      </tr>
      <tr>
          <td>IDE æ’ä»¶</td>
          <td>VSCode + Nsight / CLion + CMake</td>
      </tr>
      <tr>
          <td>æ•™ç¨‹æ¨è</td>
          <td><a href="https://developer.nvidia.com/cuda-example">CUDA by Example</a> + NVIDIA å®˜æ–¹æ–‡æ¡£</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-å°ç»“å½©è›‹">ğŸ§Š å°ç»“ï¼ˆå½©è›‹ï¼‰<a hidden class="anchor" aria-hidden="true" href="#-å°ç»“å½©è›‹">#</a></h3>
<blockquote>
<p>CUDA å°±æ˜¯ã€Œè®©ä½ çš„æ˜¾å¡ä¸ä»…ç©æ¸¸æˆï¼Œè¿˜èƒ½å·æ•°å­¦ã€ã€‚</p></blockquote>
<p>ä½ è¦æ˜¯ç ”ç©¶è®¡ç®—æœºè§†è§‰ / SLAM / æ·±åº¦å­¦ä¹ æ–¹å‘ï¼Œ<strong>æ—©æ™šéƒ½å¾—å’Œå®ƒç§°å…„é“å¼Ÿ</strong>ã€‚</p>
<h2 id="opencl">OpenCL<a hidden class="anchor" aria-hidden="true" href="#opencl">#</a></h2>
<p>æ¥äº†æ¥äº†ï¼ç°åœ¨ä¸Šåœºçš„æ˜¯çœŸæ­£çš„â€œå…¨å¹³å°ç¡¬æ ¸å¼‚æ„è®¡ç®—é»‘é­”æ³•â€â€”â€”</p>
<blockquote>
<p>ğŸ§¬ <strong>OpenCLï¼ˆOpen Computing Languageï¼‰</strong></p></blockquote>
<hr>
<h3 id="-opencl-æ˜¯ä»€ä¹ˆ">ğŸ§  OpenCL æ˜¯ä»€ä¹ˆï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-opencl-æ˜¯ä»€ä¹ˆ">#</a></h3>
<p>OpenCL æ˜¯ä¸€ç§ <strong>è·¨å¹³å°çš„å¹¶è¡Œè®¡ç®—æ¡†æ¶</strong>ï¼Œç”± Khronos Groupï¼ˆä¹Ÿå°±æ˜¯ OpenGL é‚£å¸®äººï¼‰ä¸»å¯¼å¼€å‘ï¼Œç›®æ ‡æ˜¯ï¼š</p>
<blockquote>
<p><strong>åœ¨ä»»ä½•å¹³å°ä¸Šï¼Œè®© CPUã€GPUã€FPGAã€DSP éƒ½èƒ½ä¸€èµ·æ‰“å·¥ã€‚</strong></p></blockquote>
<p>å®ƒä¸åƒ CUDA åªèƒ½ç”¨ NVIDIA æ˜¾å¡ï¼ŒOpenCL å¯ä»¥è·‘åœ¨ï¼š</p>
<ul>
<li>AMD GPU</li>
<li>Intel GPU &amp; CPU</li>
<li>NVIDIAï¼ˆæ”¯æŒä½†ä¸çƒ­æƒ…ï¼‰</li>
<li>ARM èŠ¯ç‰‡</li>
<li>Apple M ç³»åˆ—èŠ¯ç‰‡ï¼ˆmacOS ä¸Šæ˜¯äº²å„¿å­ï¼‰</li>
</ul>
<p>ğŸŒ OpenCL = çœŸÂ·å†™ä¸€ä»½ä»£ç ï¼Œè·‘å…¨ä¸–ç•Œã€‚</p>
<hr>
<h3 id="-æ¥ä¸ªç®€å•çš„ä¾‹å­çŸ¢é‡åŠ æ³•">ğŸ§ª æ¥ä¸ªç®€å•çš„ä¾‹å­ï¼šçŸ¢é‡åŠ æ³•<a hidden class="anchor" aria-hidden="true" href="#-æ¥ä¸ªç®€å•çš„ä¾‹å­çŸ¢é‡åŠ æ³•">#</a></h3>
<h4 id="-c-ä¸»æœºç«¯ä»£ç ">ğŸ§¾ C++ ä¸»æœºç«¯ä»£ç <a hidden class="anchor" aria-hidden="true" href="#-c-ä¸»æœºç«¯ä»£ç ">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;CL/cl.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;vector&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;fstream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>kernelSrc <span style="color:#f92672">=</span> R<span style="color:#e6db74">&#34;(</span>
</span></span><span style="display:flex;"><span>__kernel <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">add_vec</span>(__global <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">float</span><span style="color:#f92672">*</span> A,
</span></span><span style="display:flex;"><span>                      __global <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">float</span><span style="color:#f92672">*</span> B,
</span></span><span style="display:flex;"><span>                      __global <span style="color:#66d9ef">float</span><span style="color:#f92672">*</span> C) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> id <span style="color:#f92672">=</span> get_global_id(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    C[id] <span style="color:#f92672">=</span> A[id] <span style="color:#f92672">+</span> B[id];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>)<span style="color:#e6db74">&#34;;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> N <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>;
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">float</span><span style="color:#f92672">&gt;</span> A(N, <span style="color:#ae81ff">1.0f</span>), B(N, <span style="color:#ae81ff">2.0f</span>), C(N);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cl_platform_id platform;
</span></span><span style="display:flex;"><span>    cl_device_id device;
</span></span><span style="display:flex;"><span>    cl_context context;
</span></span><span style="display:flex;"><span>    cl_command_queue queue;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    clGetPlatformIDs(<span style="color:#ae81ff">1</span>, <span style="color:#f92672">&amp;</span>platform, <span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>    clGetDeviceIDs(platform, CL_DEVICE_TYPE_DEFAULT, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">&amp;</span>device, <span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    context <span style="color:#f92672">=</span> clCreateContext(<span style="color:#66d9ef">nullptr</span>, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">&amp;</span>device, <span style="color:#66d9ef">nullptr</span>, <span style="color:#66d9ef">nullptr</span>, <span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>    queue <span style="color:#f92672">=</span> clCreateCommandQueueWithProperties(context, device, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cl_program program <span style="color:#f92672">=</span> clCreateProgramWithSource(context, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">&amp;</span>kernelSrc, <span style="color:#66d9ef">nullptr</span>, <span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>    clBuildProgram(program, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">nullptr</span>, <span style="color:#66d9ef">nullptr</span>, <span style="color:#66d9ef">nullptr</span>, <span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cl_kernel kernel <span style="color:#f92672">=</span> clCreateKernel(program, <span style="color:#e6db74">&#34;add_vec&#34;</span>, <span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cl_mem d_A <span style="color:#f92672">=</span> clCreateBuffer(context, CL_MEM_READ_ONLY <span style="color:#f92672">|</span> CL_MEM_COPY_HOST_PTR, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">float</span>)<span style="color:#f92672">*</span>N, A.data(), <span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>    cl_mem d_B <span style="color:#f92672">=</span> clCreateBuffer(context, CL_MEM_READ_ONLY <span style="color:#f92672">|</span> CL_MEM_COPY_HOST_PTR, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">float</span>)<span style="color:#f92672">*</span>N, B.data(), <span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>    cl_mem d_C <span style="color:#f92672">=</span> clCreateBuffer(context, CL_MEM_WRITE_ONLY, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">float</span>)<span style="color:#f92672">*</span>N, <span style="color:#66d9ef">nullptr</span>, <span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    clSetKernelArg(kernel, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(cl_mem), <span style="color:#f92672">&amp;</span>d_A);
</span></span><span style="display:flex;"><span>    clSetKernelArg(kernel, <span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">sizeof</span>(cl_mem), <span style="color:#f92672">&amp;</span>d_B);
</span></span><span style="display:flex;"><span>    clSetKernelArg(kernel, <span style="color:#ae81ff">2</span>, <span style="color:#66d9ef">sizeof</span>(cl_mem), <span style="color:#f92672">&amp;</span>d_C);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    size_t global_work_size <span style="color:#f92672">=</span> N;
</span></span><span style="display:flex;"><span>    clEnqueueNDRangeKernel(queue, kernel, <span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">nullptr</span>, <span style="color:#f92672">&amp;</span>global_work_size, <span style="color:#66d9ef">nullptr</span>, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">nullptr</span>, <span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    clEnqueueReadBuffer(queue, d_C, CL_TRUE, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">float</span>)<span style="color:#f92672">*</span>N, C.data(), <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">nullptr</span>, <span style="color:#66d9ef">nullptr</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;C[42] = &#34;</span> <span style="color:#f92672">&lt;&lt;</span> C[<span style="color:#ae81ff">42</span>] <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    clReleaseMemObject(d_A); clReleaseMemObject(d_B); clReleaseMemObject(d_C);
</span></span><span style="display:flex;"><span>    clReleaseKernel(kernel); clReleaseProgram(program);
</span></span><span style="display:flex;"><span>    clReleaseCommandQueue(queue); clReleaseContext(context);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ğŸ’¡ è¾“å‡ºåº”è¯¥æ˜¯ï¼š<code>C[42] = 3</code></p>
<hr>
<h3 id="-ä¸€äº›æœ¯è¯­è§£é‡Šå’Œ-cuda-å¯¹æ¯”">ğŸ”¬ ä¸€äº›æœ¯è¯­è§£é‡Šï¼ˆå’Œ CUDA å¯¹æ¯”ï¼‰<a hidden class="anchor" aria-hidden="true" href="#-ä¸€äº›æœ¯è¯­è§£é‡Šå’Œ-cuda-å¯¹æ¯”">#</a></h3>
<table>
  <thead>
      <tr>
          <th>åŠŸèƒ½</th>
          <th>CUDA</th>
          <th>OpenCL</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>GPU å‡½æ•°åä¿®é¥°</td>
          <td><code>__global__</code></td>
          <td><code>__kernel</code></td>
      </tr>
      <tr>
          <td>çº¿ç¨‹ç´¢å¼•</td>
          <td><code>threadIdx.x</code></td>
          <td><code>get_global_id(0)</code></td>
      </tr>
      <tr>
          <td>å†…æ ¸è°ƒç”¨</td>
          <td><code>&lt;&lt;&lt;blocks, threads&gt;&gt;&gt;</code></td>
          <td><code>clEnqueueNDRangeKernel</code></td>
      </tr>
      <tr>
          <td>å†…å­˜åˆ†é…</td>
          <td><code>cudaMalloc</code></td>
          <td><code>clCreateBuffer</code></td>
      </tr>
      <tr>
          <td>ä¸»æœºâ†”è®¾å¤‡ä¼ è¾“</td>
          <td><code>cudaMemcpy</code></td>
          <td><code>clEnqueueReadBuffer</code></td>
      </tr>
      <tr>
          <td>ç¼–è¯‘å†…æ ¸</td>
          <td>é¢„ç¼–è¯‘ <code>.cu</code></td>
          <td>è¿è¡Œæ—¶ç¼–è¯‘æºç å­—ç¬¦ä¸²</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-opencl-çš„ä¼˜ç¼ºç‚¹">ğŸ’¥ OpenCL çš„ä¼˜ç¼ºç‚¹<a hidden class="anchor" aria-hidden="true" href="#-opencl-çš„ä¼˜ç¼ºç‚¹">#</a></h3>
<h4 id="-ä¼˜ç‚¹">âœ… ä¼˜ç‚¹<a hidden class="anchor" aria-hidden="true" href="#-ä¼˜ç‚¹">#</a></h4>
<ul>
<li>ğŸ§¬ çœŸÂ·è·¨å¹³å°ï¼ˆWindowsã€Linuxã€macOSã€åµŒå…¥å¼ï¼‰</li>
<li>ğŸ¦¾ è·¨è®¾å¤‡ï¼ˆCPUã€GPUã€FPGAï¼‰</li>
<li>ğŸ’¡ å®Œå…¨æ ‡å‡†ï¼Œæ²¡äººèƒ½æŠŠä½ é”æ­»</li>
</ul>
<h4 id="-ç¼ºç‚¹">âŒ ç¼ºç‚¹<a hidden class="anchor" aria-hidden="true" href="#-ç¼ºç‚¹">#</a></h4>
<ul>
<li>ğŸ§± å†™èµ·æ¥æ›´å•°å—¦ï¼ˆå¦‚ä½ æ‰€è§ï¼‰</li>
<li>ğŸ§© é©±åŠ¨é€‚é…å‘å¤šï¼ˆå°¤å…¶ AMD/NVIDIA çš„ä¸åŒè¡Œä¸ºï¼‰</li>
<li>ğŸ§  æ‰‹åŠ¨ç®¡ç†å¤ªå¤šèµ„æºï¼Œå®¹æ˜“å†™å‡ºâ€œC å¼ç¾éš¾â€</li>
</ul>
<hr>
<h3 id="-ç”¨-opencl-çš„å…¸å‹åœºæ™¯">ğŸ§  ç”¨ OpenCL çš„å…¸å‹åœºæ™¯<a hidden class="anchor" aria-hidden="true" href="#-ç”¨-opencl-çš„å…¸å‹åœºæ™¯">#</a></h3>
<ul>
<li>å¼‚æ„è®¡ç®—ä»»åŠ¡ï¼ˆCPU+GPU ååŒï¼‰</li>
<li>åµŒå…¥å¼å¹³å°ï¼Œå¦‚æ ‘è“æ´¾ã€Jetsonã€æ‰‹æœºèŠ¯ç‰‡</li>
<li>å­¦æœ¯ç ”ç©¶å¹³å°ï¼Œæƒ³ç”¨ä¸åŒç¡¬ä»¶æµ‹æ€§èƒ½</li>
<li>æ·±åº¦å­¦ä¹ éƒ¨ç½²ï¼ˆéƒ¨åˆ†æ¡†æ¶å¦‚ TensorFlow æ”¯æŒ OpenCL backendï¼‰</li>
</ul>
<hr>
<h3 id="-ç¼–è¯‘å’Œè¿è¡Œ">ğŸ”§ ç¼–è¯‘å’Œè¿è¡Œ<a hidden class="anchor" aria-hidden="true" href="#-ç¼–è¯‘å’Œè¿è¡Œ">#</a></h3>
<p>éœ€è¦å®‰è£… OpenCL SDKï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><a href="https://www.intel.com/content/www/us/en/developer/tools/opencl-sdk/overview.html">Intel OpenCL SDK</a></li>
<li><a href="https://developer.nvidia.com/opencl">NVIDIA CUDA Toolkitï¼ˆå« OpenCL 1.2 æ”¯æŒï¼‰</a></li>
<li><a href="https://portablecl.org/">POCLï¼ˆCPU Only OpenCL å®ç°ï¼‰</a></li>
</ul>
<p>ç¼–è¯‘å‘½ä»¤ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>g++ my_opencl.cpp -o run -lOpenCL
</span></span></code></pre></div><hr>
<h3 id="-æ€»ç»“ä¸€å¥è¯-1">ğŸ’ æ€»ç»“ä¸€å¥è¯ï¼š<a hidden class="anchor" aria-hidden="true" href="#-æ€»ç»“ä¸€å¥è¯-1">#</a></h3>
<blockquote>
<p>CUDA æ˜¯æ•ˆç‡è‡³ä¸Šï¼ŒOpenCL æ˜¯è‡ªç”±ä¸‡å²ã€‚</p></blockquote>
<p>å¦‚æœä½ åå¹³å°æ— å…³ã€è®¾å¤‡é€šåƒã€å…¼å®¹ ARM å’ŒåµŒå…¥å¼ï¼Œé‚£ OpenCL æ˜¯ä½ çš„å¥½å…„å¼Ÿã€‚</p>
<h2 id="å¹¶è¡Œåº“å¯¹æ¯”">å¹¶è¡Œåº“å¯¹æ¯”<a hidden class="anchor" aria-hidden="true" href="#å¹¶è¡Œåº“å¯¹æ¯”">#</a></h2>
<p>æˆ‘ä»¬ç”¨è¿™ä¸‰æ¿æ–§â€”â€”<strong>æ€§èƒ½ï¼ˆPerformanceï¼‰</strong>ã€<strong>ç”Ÿäº§æ•ˆç‡ï¼ˆProductivityï¼‰</strong>ã€<strong>æ³›ç”¨æ€§ï¼ˆGeneralityï¼‰</strong>ï¼Œæ¥ç»™è¿™äº›ä¸»æµå¹¶è¡Œç¼–ç¨‹åº“æ‰“ä¸ªåˆ†å¹¶åˆ†æå®ƒä»¬èƒŒåçš„<strong>trade-off ç­–ç•¥</strong>ï¼š</p>
<hr>
<h3 id="-è¯„åˆ†ç»´åº¦è¯´æ˜010">ğŸ§¾ è¯„åˆ†ç»´åº¦è¯´æ˜ï¼ˆ0~10ï¼‰ï¼š<a hidden class="anchor" aria-hidden="true" href="#-è¯„åˆ†ç»´åº¦è¯´æ˜010">#</a></h3>
<table>
  <thead>
      <tr>
          <th>ç»´åº¦</th>
          <th>å«ä¹‰</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ğŸ¯ æ€§èƒ½</td>
          <td>ä½å¼€é”€ã€é«˜ååã€è°ƒåº¦æ•ˆç‡ã€cacheå‹å¥½ã€è´Ÿè½½å‡è¡¡</td>
      </tr>
      <tr>
          <td>ğŸ’» ç”Ÿäº§æ•ˆç‡</td>
          <td>å­¦ä¹ æ›²çº¿ã€æ˜“ç”¨æ€§ã€æ”¹åŠ¨é‡ã€å·¥å…·é“¾æ”¯æŒ</td>
      </tr>
      <tr>
          <td>ğŸŒ æ³›ç”¨æ€§</td>
          <td>é€‚åº”ä¸åŒå¹³å°ã€ä¸åŒæ¶æ„ã€æ”¯æŒåœºæ™¯å¹¿åº¦</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-å¹¶è¡Œç¼–ç¨‹åº“å…¨æ˜æ˜Ÿè¯„åˆ†å¯¹æ¯”ä¸»è§‚ä¸»æµå…±è¯†ç»éªŒ">âš”ï¸ å¹¶è¡Œç¼–ç¨‹åº“å…¨æ˜æ˜Ÿè¯„åˆ†å¯¹æ¯”ï¼ˆä¸»è§‚+ä¸»æµå…±è¯†+ç»éªŒï¼‰ï¼š<a hidden class="anchor" aria-hidden="true" href="#-å¹¶è¡Œç¼–ç¨‹åº“å…¨æ˜æ˜Ÿè¯„åˆ†å¯¹æ¯”ä¸»è§‚ä¸»æµå…±è¯†ç»éªŒ">#</a></h3>
<table>
  <thead>
      <tr>
          <th>åº“</th>
          <th>æ€§èƒ½ ğŸ¯</th>
          <th>ç”Ÿäº§æ•ˆç‡ ğŸ’»</th>
          <th>æ³›ç”¨æ€§ ğŸŒ</th>
          <th>trade-off ç®€è¿°</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>OpenMP</strong></td>
          <td>7</td>
          <td>ğŸ”¥<strong>9</strong></td>
          <td>7</td>
          <td>æ€§èƒ½ä¸æ˜¯æœ€æè‡´ï¼Œä½†èƒœåœ¨â€œå‡ è¡Œèµ·é£â€ã€‚ç‰ºç‰²è°ƒåº¦è‡ªç”±æ¢æ¥æé«˜çš„ç”Ÿäº§æ•ˆç‡ã€‚</td>
      </tr>
      <tr>
          <td><strong>TBB</strong></td>
          <td>ğŸ”¥<strong>9</strong></td>
          <td>7</td>
          <td>8</td>
          <td>ç‰ºç‰²ä¸Šæ‰‹é€Ÿåº¦å’Œä»£ç ç®€æ´åº¦ï¼Œæ¢æ¥äº†æå¼ºçš„è°ƒåº¦èƒ½åŠ›ä¸ç»„åˆèƒ½åŠ›ã€‚</td>
      </tr>
      <tr>
          <td><strong>std::thread / async</strong></td>
          <td>6</td>
          <td>6</td>
          <td>ğŸ”¥<strong>9</strong></td>
          <td>ä¸‡é‡‘æ²¹å¼æ³›ç”¨ï¼Œç²’åº¦å¤ªç»†ï¼Œå†™èµ·æ¥ç—›è‹¦ï¼Œè°ƒåº¦å…¨é è‡ªå·±ã€‚æ˜“é”™ä¸”ä¸ scaleã€‚</td>
      </tr>
      <tr>
          <td><strong>Pthreads</strong></td>
          <td>ğŸ”¥<strong>10</strong></td>
          <td>3</td>
          <td>8</td>
          <td>æ€§èƒ½å¤©èŠ±æ¿çº§ï¼Œä½†å¼€å‘ä½“éªŒå ªæ¯”ç‚¼ç‹±ã€‚è°ƒåº¦å’ŒåŒæ­¥å…¨æ‰‹æ’¸ã€‚</td>
      </tr>
      <tr>
          <td><strong>CUDA / OpenCL</strong></td>
          <td>ğŸ”¥<strong>10</strong></td>
          <td>4</td>
          <td>5</td>
          <td>GPUä¸‹çš„æ€§èƒ½æš´é¾™ï¼Œä½†å¼€å‘æˆæœ¬é«˜ï¼Œæ³›ç”¨æ€§å·®ï¼ˆå¹³å°ä¾èµ–å¤§ï¼‰ã€‚</td>
      </tr>
      <tr>
          <td><strong>HPX</strong></td>
          <td>8</td>
          <td>5</td>
          <td>ğŸ”¥<strong>10</strong></td>
          <td>æ³›ç”¨æ€§é¡¶çº§ï¼Œç”šè‡³æ”¯æŒåˆ†å¸ƒå¼å’ŒC++åç¨‹ï¼Œä½†å­¦ä¹ é—¨æ§›é«˜ã€ç”Ÿæ€è¿˜åœ¨æˆé•¿ã€‚</td>
      </tr>
      <tr>
          <td><strong>Kokkos / RAJA</strong></td>
          <td>8</td>
          <td>6</td>
          <td>9</td>
          <td>åœ¨æ€§èƒ½å’Œå¯ç§»æ¤æ€§ä¹‹é—´æ‰“å¹³è¡¡ï¼Œé€‚åˆå¤§ç§‘ç ”é¡¹ç›®ï¼Œè½»é‡å·¥ç¨‹ä¸­åé‡ã€‚</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-å®ƒä»¬éƒ½åšäº†ä»€ä¹ˆ-trade-off">ğŸ“‰ å®ƒä»¬éƒ½åšäº†ä»€ä¹ˆ trade-offï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-å®ƒä»¬éƒ½åšäº†ä»€ä¹ˆ-trade-off">#</a></h3>
<h4 id="-openmp-çš„å“²å­¦è®©ä½ 5åˆ†é’Ÿèƒ½è·‘èµ·æ¥åˆ«çº ç»“è°ƒåº¦">ğŸ§© OpenMP çš„å“²å­¦ï¼š<strong>â€œè®©ä½ 5åˆ†é’Ÿèƒ½è·‘èµ·æ¥ï¼Œåˆ«çº ç»“è°ƒåº¦â€</strong><a hidden class="anchor" aria-hidden="true" href="#-openmp-çš„å“²å­¦è®©ä½ 5åˆ†é’Ÿèƒ½è·‘èµ·æ¥åˆ«çº ç»“è°ƒåº¦">#</a></h4>
<ul>
<li>ğŸŒŸ ä¼˜å…ˆçº§ï¼šç”Ÿäº§æ•ˆç‡ ï¼ æ³›ç”¨æ€§ ï¼ æ€§èƒ½</li>
<li>ğŸŒŒ å®ƒå¸Œæœ›ä½ ä¸€å¼€å§‹å°±èƒ½çœ‹åˆ°æé€Ÿï¼ˆå°¤å…¶åœ¨ç§‘ç ”åœˆã€å·¥ä¸šå°é¡¹ç›®ï¼‰</li>
<li>ğŸ§¨ ç¼ºç‚¹æ˜¯ä½ æ— æ³• fine-grain æ§åˆ¶ä»»åŠ¡è°ƒåº¦ï¼Œå†™å¤æ‚ç»“æ„å°±ä¸è¡Œäº†</li>
</ul>
<hr>
<h4 id="-tbb-çš„å“²å­¦æˆ‘è¦ç»™ä½ ä¸€ä¸ªç°ä»£å¯ç»„åˆçš„å¹¶å‘èŒƒå¼">ğŸ§© TBB çš„å“²å­¦ï¼š<strong>â€œæˆ‘è¦ç»™ä½ ä¸€ä¸ªç°ä»£ã€å¯ç»„åˆçš„å¹¶å‘èŒƒå¼â€</strong><a hidden class="anchor" aria-hidden="true" href="#-tbb-çš„å“²å­¦æˆ‘è¦ç»™ä½ ä¸€ä¸ªç°ä»£å¯ç»„åˆçš„å¹¶å‘èŒƒå¼">#</a></h4>
<ul>
<li>ğŸŒŸ ä¼˜å…ˆçº§ï¼šæ€§èƒ½ â‰ˆ æ³›ç”¨æ€§ ï¼ ç”Ÿäº§æ•ˆç‡</li>
<li>ğŸ§  å¼ºè°ƒâ€œç»“æ„åŒ–å¹¶å‘â€ã€<code>task_arena</code>, <code>flow::graph</code>ï¼Œä»»åŠ¡é—´ä¾èµ–ã€å¼‚æ­¥ç®¡æ§æ ·æ ·èƒ½æ•´</li>
<li>ğŸ˜“ ä½†ä»£ä»·æ˜¯ï¼šä½ å¾—ä¼šä¸€ç‚¹ç°ä»£ C++ï¼Œç†è§£ä»»åŠ¡æµå’Œèµ„æºè°ƒåº¦æ¨¡å‹</li>
</ul>
<hr>
<h4 id="-pthreads--stdthread-çš„å“²å­¦æˆ‘å°±æ˜¯çº¿ç¨‹æœ¬ä½“ä½ è‡ªç”±å‘æŒ¥">ğŸ§© Pthreads / std::thread çš„å“²å­¦ï¼š<strong>â€œæˆ‘å°±æ˜¯çº¿ç¨‹æœ¬ä½“ï¼Œä½ è‡ªç”±å‘æŒ¥â€</strong><a hidden class="anchor" aria-hidden="true" href="#-pthreads--stdthread-çš„å“²å­¦æˆ‘å°±æ˜¯çº¿ç¨‹æœ¬ä½“ä½ è‡ªç”±å‘æŒ¥">#</a></h4>
<ul>
<li>ğŸŒŸ ä¼˜å…ˆçº§ï¼šæ³›ç”¨æ€§ ï¼ æ€§èƒ½ ï¼ ç”Ÿäº§æ•ˆç‡</li>
<li>ğŸ› ï¸ å¯¹æå®¢è‡ªç”±ï¼Œä½†æåº¦ç¹çã€å®¹æ˜“è¸©å‘ã€å¾ˆéš¾æ‰©å±•æˆå¯ç»´æŠ¤é¡¹ç›®ç»“æ„</li>
</ul>
<hr>
<h4 id="-cuda--opencl-çš„å“²å­¦ç‰ºç‰²å¯è¯»æ€§æ¢å–ååç‡">ğŸ§© CUDA / OpenCL çš„å“²å­¦ï¼š<strong>â€œç‰ºç‰²å¯è¯»æ€§ï¼Œæ¢å–ååç‡â€</strong><a hidden class="anchor" aria-hidden="true" href="#-cuda--opencl-çš„å“²å­¦ç‰ºç‰²å¯è¯»æ€§æ¢å–ååç‡">#</a></h4>
<ul>
<li>ğŸŒŸ ä¼˜å…ˆçº§ï¼šæ€§èƒ½ &raquo;&gt; å…¶ä»–</li>
<li>âš™ï¸ å¼€å‘æ…¢ï¼Œä½†è®¡ç®—å¯†é›†å‹ä»»åŠ¡ä¸Šæ— æ•Œ</li>
<li>ğŸ’€ æŠ½è±¡å±‚ä½ã€è°ƒåº¦æ¨¡å‹å¤æ‚ï¼Œä¸é€‚åˆé¢‘ç¹å˜æ¢éœ€æ±‚çš„é¡¹ç›®</li>
</ul>
<hr>
<h4 id="-hpx--kokkos-çš„å“²å­¦æœªæ¥ç¼–ç¨‹çš„é›å½¢">ğŸ§© HPX / Kokkos çš„å“²å­¦ï¼š<strong>â€œæœªæ¥ç¼–ç¨‹çš„é›å½¢â€</strong><a hidden class="anchor" aria-hidden="true" href="#-hpx--kokkos-çš„å“²å­¦æœªæ¥ç¼–ç¨‹çš„é›å½¢">#</a></h4>
<ul>
<li>ğŸŒŸ ä¼˜å…ˆçº§ï¼šæ³›ç”¨æ€§ &gt; æ€§èƒ½ &gt; ç”Ÿäº§æ•ˆç‡</li>
<li>ğŸ”® ä¸ºå¼‚æ„+å¼‚æ­¥+å¤šèŠ‚ç‚¹ç³»ç»ŸæœåŠ¡ï¼Œå­¦æœ¯æ½œåŠ›è‚¡</li>
<li>ğŸ“š å­¦ä¹ æˆæœ¬å¾ˆé«˜ï¼Œä½†æœªæ¥éšç€ C++20/23 çš„æ™®åŠï¼Œå¯èƒ½ä¼šæ›´å‹å¥½</li>
</ul>
<hr>
<h3 id="-æ€»ç»“å›¾åƒè®°å¿†å¸®ä½ è®°ä½">ğŸ‘‘ æ€»ç»“å›¾åƒè®°å¿†ï¼ˆå¸®ä½ è®°ä½ï¼‰<a hidden class="anchor" aria-hidden="true" href="#-æ€»ç»“å›¾åƒè®°å¿†å¸®ä½ è®°ä½">#</a></h3>
<pre tabindex="0"><code>        æ€§èƒ½
          â–²
          |
       ğŸ§  TBB       ğŸ”§ CUDA
        | \         /
        |   \     /
   OpenMP  std::thread
        \     /
        ç®€æ´æ€§
           |
      ğŸ’» ç”Ÿäº§æ•ˆç‡
</code></pre><p>OpenMP æ˜¯é‚£ç§â€œå·¥ç¨‹é‡Œæé€Ÿä¸æ±‚äººâ€çš„è€é“ï¼›<br>
TBB æ˜¯â€œæ„¿æ„å¤šå†™å‡ è¡Œï¼Œæ¢ä½ ç¨³å®šæ‰©å±•â€ï¼›<br>
CUDA æ˜¯â€œè€å­å°±æ˜¯è¦è·‘å¾—å¿«â€ï¼›<br>
HPX æ˜¯â€œæˆ‘ä¸ºå¹¶è¡Œå®‡å®™å¸ƒé“â€ã€‚</p>
<h2 id="å¤§å®¶æ€ä¹ˆé€‰">å¤§å®¶æ€ä¹ˆé€‰<a hidden class="anchor" aria-hidden="true" href="#å¤§å®¶æ€ä¹ˆé€‰">#</a></h2>
<p>å“å˜¿ï¼Œè¿™é—®é¢˜é—®å¾—åƒæäº†â€œç¥ä»™æ‰“æ¶è°ä¸»æ²‰æµ®â€ï¼Œè¿™å°±å¸¦ä½ é€›ä¸€åœˆ<strong>å¹¶è¡Œç¼–ç¨‹æ±Ÿæ¹–</strong>ï¼Œçœ‹çœ‹ TBB å’Œ OpenMP çš„å¯¹æ‰‹ä»¬éƒ½æ˜¯ä»€ä¹ˆæ®µä½ï¼Œè°åˆåœ¨å¼€å‘è€…ä¸­å äº†ä¸»è§’æˆã€‚</p>
<hr>
<h3 id="-é¡¶æµé€‰æ‰‹å¤©æ¢¯æ¦œä¸»æ‰“-cc-å…±äº«å†…å­˜å¹¶è¡Œ">ğŸ† é¡¶æµé€‰æ‰‹å¤©æ¢¯æ¦œï¼ˆä¸»æ‰“ C/C++ å…±äº«å†…å­˜å¹¶è¡Œï¼‰ï¼š<a hidden class="anchor" aria-hidden="true" href="#-é¡¶æµé€‰æ‰‹å¤©æ¢¯æ¦œä¸»æ‰“-cc-å…±äº«å†…å­˜å¹¶è¡Œ">#</a></h3>
<table>
  <thead>
      <tr>
          <th>åå­—</th>
          <th>ç±»å‹</th>
          <th>èƒŒæ™¯</th>
          <th>ç‰¹ç‚¹</th>
          <th>é€‚åˆäººç¾¤</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>OpenMP</strong></td>
          <td>ç¼–è¯‘å™¨æ‰©å±• API</td>
          <td>å¤šå‚å•†è”ç›Ÿ</td>
          <td>pragma ä¸Šæ‰‹å¿«ï¼Œä¸»æ‰“å¿«é€Ÿå¹¶è¡ŒåŒ–</td>
          <td>æƒ³è½»é‡æé€Ÿçš„å·¥ç¨‹å¸ˆã€ç§‘ç ”äºº</td>
      </tr>
      <tr>
          <td><strong>TBB</strong></td>
          <td>C++ åº“</td>
          <td>Intel äº²å„¿å­</td>
          <td>ç°ä»£C++é£æ ¼ã€çµæ´»æ€§é«˜ã€ä»»åŠ¡è°ƒåº¦ç‰›</td>
          <td>å–œæ¬¢ç»“æ„æ¸…æ™°ã€é«˜çº§å°è£…çš„å¼€å‘è€…</td>
      </tr>
      <tr>
          <td><strong>C++ std::thread / std::async / std::future</strong></td>
          <td>C++æ ‡å‡†åº“</td>
          <td>ISO C++å®˜æ–¹</td>
          <td>åŸç”Ÿæ— ä¾èµ–ï¼Œå†™æ³•åº•å±‚åç¡¬æ ¸</td>
          <td>æƒ³ç©åŸæ•™æ—¨C++çº¿ç¨‹çš„è€å“¥</td>
      </tr>
      <tr>
          <td><strong>Pthreadsï¼ˆPOSIX threadsï¼‰</strong></td>
          <td>ç³»ç»Ÿçº§åº“</td>
          <td>POSIXæ ‡å‡†</td>
          <td>åº•å±‚æ§åˆ¶æœ€ç»†ï¼Œä½†å†™èµ·æ¥æœ€çƒ¦</td>
          <td>ç³»ç»Ÿå·¥ç¨‹å¸ˆ / æƒ³åƒè‹¦çš„å‹‡å£«</td>
      </tr>
      <tr>
          <td><strong>CUDA / OpenCL</strong></td>
          <td>å¼‚æ„å¹¶è¡Œè®¡ç®—</td>
          <td>NVIDIA / Khronos Group</td>
          <td>GPUåŠ é€Ÿç¥å™¨ï¼Œçº¿ç¨‹ä¸Šä¸‡èµ·æ­¥</td>
          <td>åšé«˜æ€§èƒ½è®¡ç®—ã€å›¾å½¢ã€AIçš„åŒå­¦</td>
      </tr>
      <tr>
          <td><strong>HPX</strong></td>
          <td>C++ å¼‚æ­¥å¹¶è¡Œæ¡†æ¶</td>
          <td>é«˜æ€§èƒ½è®¡ç®—åœˆ</td>
          <td>å…¨å¼‚æ­¥ã€åˆ†å¸ƒå¼å‹å¥½ï¼ŒC++20 åç¨‹åä½œå¥½</td>
          <td>HPCæå®¢ã€æœªæ¥å¹¶è¡Œæ¶æ„å®éªŒå…š</td>
      </tr>
      <tr>
          <td><strong>Kokkos / RAJA</strong></td>
          <td>C++å¹¶è¡ŒæŠ½è±¡åº“</td>
          <td>Sandia / LLNL</td>
          <td>å±è”½å¹³å°å·®å¼‚ï¼Œä¸€å¥—ä»£ç è·‘CPU/GPU</td>
          <td>ç§‘ç ” &amp; è¶…ç®—é¢†åŸŸå¼€å‘è€…</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-å¼€å‘è€…æ›´å–œæ¬¢è°">ğŸ§­ å¼€å‘è€…æ›´å–œæ¬¢è°ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-å¼€å‘è€…æ›´å–œæ¬¢è°">#</a></h3>
<p>è¿™ä¸ªé—®é¢˜è¯´åˆ°åº•è¦çœ‹ä¸‰ä¸ªå­—â€”â€”<strong>åœºæ™¯å…š</strong>ã€‚</p>
<h4 id="1-openmpä¸­å°è§„æ¨¡å¹¶è¡Œçš„ç¬¬ä¸€é€‰æ‹©">1. <strong>OpenMPï¼šä¸­å°è§„æ¨¡å¹¶è¡Œçš„ç¬¬ä¸€é€‰æ‹©</strong><a hidden class="anchor" aria-hidden="true" href="#1-openmpä¸­å°è§„æ¨¡å¹¶è¡Œçš„ç¬¬ä¸€é€‰æ‹©">#</a></h4>
<ul>
<li>å¦‚æœä½ å†™çš„æ˜¯ç§‘ç ”ã€å›¾åƒå¤„ç†ã€ç‚¹äº‘éå†ã€çŸ©é˜µè¿ç®—ã€å›¾åƒå·ç§¯ã€SLAMæ¨¡å—è¿™äº›éœ€è¦<strong>å±€éƒ¨åŠ é€Ÿ</strong>çš„ä¸œè¥¿ï¼›</li>
<li>å¹¶ä¸”ä½ æƒ³ <strong>ç”¨æœ€å°ä»£ä»·æé€Ÿ</strong> â€”â€”<br>
âœ… å¤§å¤šæ•°äººé¦–é€‰ OpenMPã€‚</li>
</ul>
<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå®ƒï¼š</p>
<ul>
<li>ä¸Šæ‰‹å¿«ï¼ˆåŠ ä¸ª <code>#pragma</code> å°±è¡Œï¼‰</li>
<li>æ”¯æŒå¤§éƒ¨åˆ†ç¼–è¯‘å™¨ï¼ˆGCCã€Clangã€MSVC éƒ½æ‡‚ï¼‰</li>
<li>å¯¹è€ä»£ç å…¼å®¹å¥½ï¼Œæ”¹åŠ¨å°‘</li>
</ul>
<h4 id="2-tbbç°ä»£cå…šå’Œæ¡†æ¶æ´¾çš„èœ">2. <strong>TBBï¼šç°ä»£C++å…šå’Œæ¡†æ¶æ´¾çš„èœ</strong><a hidden class="anchor" aria-hidden="true" href="#2-tbbç°ä»£cå…šå’Œæ¡†æ¶æ´¾çš„èœ">#</a></h4>
<ul>
<li>ä½ è¦å†™ä¸ªç°ä»£æ¡†æ¶ï¼Œæˆ–è€…ä½ è¿½æ±‚ <strong>ä»»åŠ¡è°ƒåº¦ä¼˜åŒ–ã€åµŒå¥—å¹¶è¡Œã€ç»„åˆè¡¨è¾¾èƒ½åŠ›</strong>ï¼›</li>
<li>åˆæˆ–è€…ä½ å†™çš„æ˜¯æ¯”å¦‚å›¾å½¢ç®¡çº¿ã€AIä¸­é—´ä»¶ã€ç¼–è¯‘å™¨å·¥å…·é“¾â€¦â€¦</li>
</ul>
<p>âœ… é‚£ä½ ä¼šçˆ±ä¸Š TBBã€‚</p>
<p>å®ƒæ¯” OpenMP çµæ´»ï¼Œä»£ç æ›´ä¼˜é›…ï¼Œè€Œä¸”é…åˆ <code>task_arena</code>, <code>concurrent_vector</code>, <code>flow::graph</code> è¿™äº›ç»„ä»¶èƒ½é€ å‡ºä¸€æ•´ä¸ªå¹¶è¡Œå¸å›½ã€‚</p>
<h4 id="3-gpuå…šèµ°çš„æ˜¯-cuda--opencl-è·¯çº¿">3. <strong>GPUå…šèµ°çš„æ˜¯ CUDA / OpenCL è·¯çº¿</strong><a hidden class="anchor" aria-hidden="true" href="#3-gpuå…šèµ°çš„æ˜¯-cuda--opencl-è·¯çº¿">#</a></h4>
<p>å¦‚æœä½ ç›®æ ‡æ˜¯å¤§è§„æ¨¡å¹¶è¡Œï¼ˆæ¯”å¦‚è·‘ AIã€ç‰©ç†ä»¿çœŸã€æ¸²æŸ“ï¼‰ï¼Œé‚£ï¼š</p>
<blockquote>
<p>OpenMP å’Œ TBB éƒ½æ˜¯å°æ‰“å°é—¹ï¼Œå¾—ä¸Š CUDA / ROCm / oneAPI è¿™ç§æ ¸çˆ†çº§åˆ«çš„ä¸œè¥¿ã€‚</p></blockquote>
<hr>
<h3 id="-å¤§ä¼—ä½¿ç”¨ç‡æ¦‚ç•¥æ„ŸçŸ¥">ğŸ¥‡ å¤§ä¼—ä½¿ç”¨ç‡ï¼ˆæ¦‚ç•¥æ„ŸçŸ¥ï¼‰ï¼š<a hidden class="anchor" aria-hidden="true" href="#-å¤§ä¼—ä½¿ç”¨ç‡æ¦‚ç•¥æ„ŸçŸ¥">#</a></h3>
<table>
  <thead>
      <tr>
          <th>å¹¶è¡Œåº“</th>
          <th>ä½¿ç”¨ç‡ï¼ˆç§‘ç ” &amp; å·¥ç¨‹åœˆï¼‰</th>
          <th>ä¸»æµç¨‹åº¦</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>OpenMP</td>
          <td>â­â­â­â­â­</td>
          <td>è¶…ä¸»æµï¼Œæ•™æçº§åº“</td>
      </tr>
      <tr>
          <td>TBB</td>
          <td>â­â­â­â­</td>
          <td>å·¥ç¨‹ç”¨å¾—å¤šï¼Œç§‘ç ”ç¨å°‘</td>
      </tr>
      <tr>
          <td>std::thread</td>
          <td>â­â­â­</td>
          <td>å¯ç§»æ¤ä½†ååº•å±‚</td>
      </tr>
      <tr>
          <td>Pthreads</td>
          <td>â­â­</td>
          <td>ç³»ç»Ÿå¼€å‘ç”¨</td>
      </tr>
      <tr>
          <td>CUDA/OpenCL</td>
          <td>â­â­â­â­</td>
          <td>GPUåœˆä¸»æµ</td>
      </tr>
      <tr>
          <td>HPX/Kokkos</td>
          <td>â­â­</td>
          <td>è¶…ç®—ç§‘ç ”åœˆæ‰æ‡‚</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="-æœªæ¥è¶‹åŠ¿æ€ä¹ˆçœ‹">ğŸ’¡ æœªæ¥è¶‹åŠ¿æ€ä¹ˆçœ‹ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#-æœªæ¥è¶‹åŠ¿æ€ä¹ˆçœ‹">#</a></h3>
<ul>
<li><strong>OpenMP</strong> ä¼šç»§ç»­å½“ã€Œå¿«é€Ÿå¹¶è¡ŒåŒ–ã€çš„ç¬¬ä¸€åº“ï¼Œç‰¹åˆ«æ˜¯åœ¨ AI åŠ é€Ÿé¢„å¤„ç†ã€è¾¹ç¼˜è®¡ç®—ã€å›¾åƒã€SLAM ç­‰æ–¹å‘ã€‚</li>
<li><strong>TBB</strong> åœ¨ oneAPIã€å¼‚æ„è°ƒåº¦ä¸Šçš„å®šä½è¶Šæ¥è¶Šå¼º â€”â€” ä»¥åä½ æƒ³åœ¨ CPU + GPU + FPGA ä¸Šç»Ÿä¸€è°ƒåº¦ï¼Œå®ƒä¼šæ˜¯ä¸ªé‡è¦é½¿è½®ã€‚</li>
<li><strong>std::executionï¼ˆC++23ï¼‰</strong> å¼€å§‹æç»Ÿä¸€å¹¶å‘æ¡†æ¶ï¼Œæœªæ¥ä¼šé€æ¸æŒ‘æˆ˜ TBB çš„åœ°ä½ã€‚</li>
</ul>
<hr>
<h3 id="-æ‰€ä»¥æ€»ç»“">ğŸ”® æ‰€ä»¥æ€»ç»“ï¼š<a hidden class="anchor" aria-hidden="true" href="#-æ‰€ä»¥æ€»ç»“">#</a></h3>
<blockquote>
<p>æƒ³æé€Ÿå°±ä¸Š OpenMPï¼Œ<br>
æƒ³åšç»“æ„ç²¾å·§çš„å¹¶è¡Œç³»ç»Ÿä¸Š TBBï¼Œ<br>
æƒ³å†² AI/å›¾å½¢å°±ç›´å¥” CUDAï¼Œ<br>
æƒ³åšå…ˆé”‹å®éªŒå¯ä»¥è¯•è¯• HPXã€Kokkosã€‚</p></blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/parallel/">Parallel</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Citrus Cheng&#39;s wiki</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
